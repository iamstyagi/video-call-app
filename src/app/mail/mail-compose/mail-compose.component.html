<div class="flex align-items-center mt-2 px-4 md:px-0 border-top-1 surface-border md:border-none pt-4 md:pt-0">
    <!-- <span class="block text-900 font-bold text-xl">Compose Email</span> -->
</div>
<div class="surface-section grid mt-2 grid-nogutter formgrid p-4 gap-3 md:surface-border md:border-1 border-round"
    style="overflow-y: scroll; max-height: 450px; padding: 5px !important;  border-color: gainsboro;">
    <div class="col-4 field flex flex-wrap" >
        <span for="to" class="text-900  col-12 mb-0 md:col-2 md:mb-0"
            style="padding-top: 10px;">Account</span>
        <span class="p-input-icon-right col-12 mb-0 md:col-10 md:mb-0">
            <p-dropdown [options]="accountDropdown" [(ngModel)]="newMail.from" optionLabel="label" optionValue="value"
                class="p-inputtext-sm newCssAdded" optionValue="value" (onSelect)="chanegAc($event)"></p-dropdown>

        </span>
    </div>
    <div class="col-4 field flex flex-wrap">
        <span for="template" class="text-900  col-12 mb-0 md:col-2 md:mb-0"
            style="padding-top: 10px;">To</span>
        <span class="p-input-icon-right col-12 mb-0 md:col-10 md:mb-0">
            <p-chips  [(ngModel)]="resultArray" #chips  (onAdd)="onAddE($event)" (onRemove)="onRemoveE($event)" >
            </p-chips>
            <input id="to" type="text" pInputText [(ngModel)]="newMail.to"  (input)="filterMails()"  (keyup.enter)="newValueDetails()"  
            (blur)="updateValueNew()"
                class="w-full pl-0 text-900  p-inputtext-sm" style="position: relative;
                bottom: 45px;
                border-bottom: none;
                outline: none;
                box-shadow: none;
                border-bottom-left-radius: 0;
                border-bottom-right-radius: 0;"  autocomplete="off" />
                <ul *ngIf="filteredMails.length > 0" class="card autocomplete-list" >
                    <li *ngFor="let item of filteredMails" (click)="onSelect(item)">
                      {{ item.name }}
                    </li>
                  </ul>
        </span>
    </div>
    <div class="col-4 field flex flex-wrap" style="margin-top: 3px;">
        <span for="template" class="text-900  col-12 mb-0 md:col-2 md:mb-0"
            style="padding-top: 10px;">CC</span>
        <span class="p-input-icon-right col-12 mb-0 md:col-10 md:mb-0">
                <p-chips  [(ngModel)]="resultArrayCC" #chips  (onAdd)="onAddECC($event)" (onRemove)="onRemoveECC($event)" >
                </p-chips>
                <input id="cc" type="text" pInputText [(ngModel)]="fld_CC"  (input)="filterMailsCC()"  (keyup.enter)="newValueDetailsCC()"   (blur)="updateValueNewCC()"
                    class="w-full pl-0 text-900  p-inputtext-sm" style="position: relative;
                    bottom: 45px;
                    border-bottom: none;
                    outline: none;
                    box-shadow: none;
                    border-bottom-left-radius: 0;
                    border-bottom-right-radius: 0;"  autocomplete="off" />
                    <ul *ngIf="filteredMailsCC.length > 0" class="card autocomplete-list" >
                        <li *ngFor="let item of filteredMailsCC" (click)="onSelectCC(item)">
                          {{ item.name }}
                        </li>
                      </ul>
        </span>
    </div>
    <div class="col-4 field flex flex-wrap">
        <span for="template" class="text-900  col-12 mb-0 md:col-2 md:mb-0"
            style="padding-top: 10px;">BCC</span>
        <span class="p-input-icon-right col-12 mb-0 md:col-10 md:mb-0">
                <p-chips  [(ngModel)]="resultArrayBCC" #chips  (onAdd)="onAddEBCC($event)" (onRemove)="onRemoveEBCC($event)" >
                </p-chips>
                <input id="bcc" type="text" pInputText [(ngModel)]="fld_BCC"  (input)="filterMailsBCC()"  (keyup.enter)="newValueDetailsBCC()" (blur)="updateValueNewBCC()"
                    class="w-full pl-0 text-900  p-inputtext-sm" style="position: relative;
                    bottom: 45px;
                    border-bottom: none;
                    outline: none;
                    box-shadow: none;
                    border-bottom-left-radius: 0;
                    border-bottom-right-radius: 0;"  autocomplete="off" />
                    <ul *ngIf="filteredMailsBCC.length > 0" class="card autocomplete-list" >
                        <li *ngFor="let item of filteredMailsBCC" (click)="onSelectBCC(item)">
                          {{ item.name }}
                        </li>
                      </ul>
        </span>
    </div>
    <div class="col-4 field flex flex-wrap">
        <span for="Subject" class="text-900  col-12 mb-0 md:col-2 md:mb-0"
            style="padding-top: 10px;">Subject</span>
        <span class="p-input-icon-right  col-12 mb-0 md:col-10 md:mb-0">

            <input id="subject" type="text" pInputText [(ngModel)]="newMail.title" placeholder="Subject"
                class="w-full pl-7 text-900  p-inputtext-sm newAddedOne" autocomplete="off" />
            <i class="pi pi-pencil" style="    right: 1.5rem;
            top: 23px;
        "></i>
        </span>
    </div>
    <div class="col-4 field flex flex-wrap">
        <span for="template" class="text-900  col-12 mb-0 md:col-2 md:mb-0"
            style="padding-top: 10px;">Template</span>
        <span class="p-input-icon-right col-12 mb-0 md:col-10 md:mb-0">
            <p-dropdown [options]="templateArr" [(ngModel)]="selectTemp" optionLabel="label" optionValue="value"
                placeholder="Select Template" class="p-inputtext-sm newCssAdded" optionValue="value" (click)="getTemplate()"
                (onSelect)="selectedReplyTemplate($event)" (onChange)="selectedReplyTemplate($event)"></p-dropdown>
        </span>
    </div>

    <div class="col-12" style="padding: 0 14px;">
        <p-fileUpload accept="image/jpeg,image/png,image/gif,application/vnd.ms-excel,application/pdf,
                    application/msword,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,
                    application/vnd.openxmlformats-officedocument.wordprocessingml.document,
                    audio/mpeg,video/mp4" maxFileSize="50000000" [multiple]="true" customUpload="true"
            (uploadHandler)="uploadHandler($event)" (onComplete)="onUpload($event)" [multiple]="true">
        </p-fileUpload>
    </div>
    <div class="col-12 field" style="padding: 0 14px;">
        <p-editor [style]="{'height':'150px'}" [(ngModel)]="newMail.message"  (onTextChange)="onTextChange($event)" ></p-editor>
        <div *ngIf="signature" style="border: 1px solid lightgray; 
        max-height: 100%;
        border-radius: none;
        height: auto;
        border-top: unset;
        padding: 20px;" [readonly]="true" [innerHTML]="signature | safeHtml"></div>

    </div>
    <div class="col-12 field" style="padding: 0 14px;">
        <p-button label="New Ticket" (onClick)="newTicket()" [hidden]="!ticketEnable"></p-button>
    </div>
<!-- ticket Enabled conditon -->
  

<!-- yha se -->
<ng-container *ngIf="newTicketFlag">
    <div class="p-fluid formgrid grid" style="    width: 100%;
    " [hidden]="!ticketEnable">
        <div class="col-12 md:col-12" style="padding: 0.3rem;"  [hidden]="!ticketEnable">
            <!-- <div class="card dispositioncard"> -->
            <!-- <div class="cardTicket dispositioncard1" style="background-color:rgb(3, 83, 136);" [hidden]="!ticketEnable">
                <span style="color:white; padding-left:10px;">Script</span>
            </div> -->
            <div class="cardTicket dispositioncard2" [hidden]="!ticketEnable">
                <!-- <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                    <div class="col-12 mb-0 md:col-11 md:mb-0">
                        <textarea rows="2" cols="100" id="script" name="script" pInputTextarea placeholder=" "></textarea>
                    </div>
                </div> -->
                <div class="cardTicket" style="background-color:#1089bec9;" *ngIf="showTicketCard">
                    <ul style="display: flex; color:white; margin-top:0rem; margin-bottom:0rem; padding-left:0.5rem;font-size: 14px;">
                        <li>TicketNo: {{ticketNo}}</li>
                        <span style="margin-left:40px;"></span>
                        <li>Source: {{sourceName}}</li>
                        <span style="margin-left:40px;"></span>
                        <li>Campaign: {{ticketCampaignName}}</li>
                        <span style="margin-left:40px;"></span>
                        <li>ActionNo: {{actionNo}}</li>
                        <span style="margin-left:40px;"></span>
                        <li>Ticket Time: {{ticketTime}}</li>
                        <span style="margin-left:40px;"></span>
                        <li>Duration: {{ticketDuration}}</li>
                    </ul>
    
                </div>
                <div class="" style="    width: 100%;border-bottom: 0.2px dotted #8080809c; " *ngIf="newTicketFlag">
                    <div class="col-12 md:col-12" style="padding: 0.3rem;" >
                        <div class="">
                    <form [formGroup]="customForm">
                        <div>
                            <div class=" dynamic-form-card">
                                <div class="p-fluid formgrid grid">
                                    <ng-container *ngFor="let field of formFields">
                                        <div *ngIf="field.fld_isNewRow==true" style="min-inline-size: -webkit-fill-available !important;">
                                        </div>
                                        <div class="field col-12 md:col-12" *ngIf="field.isSeparator==true">{{field.separatorText}}</div>
                                        <div style="font-size:11px !important; margin-top:5px;" class="field col-12 md:col-2" *ngIf="field.fld_Enable_Search==false">
                                            <span style="padding-left:10px; ">{{field.name}}</span>
                                        </div>
                                        <div class="field col-12 md:col-2">
                                            <span
                                                *ngIf="field.controlType.value == 0 && field.displayInClient==true && field.isUsed==true && field.isUsed==true && field.fld_Enable_Search==false">
                                                <div
                                                    *ngIf="field.name == 'Phone Number' || field.name == 'PhoneNo' || field.name == 'PhoneNo*' || field.name == 'Phone No'">
                                                    <input type="text" pInputText [formControlName]="field.fld_FieldName" *ngIf="!isMasked" 
                                                        required="field.required" class="p-inputtext-sm" 
                                                        style=" user-select: none !important;"   >
                    
                                                    <input type="text" pInputText id="phoneInput" *ngIf="isMasked" required="field.required"
                                                        class="p-inputtext-sm" 
                                                        style=" user-select: none !important;">
                    
                                                </div>
                    
                                                <!-- <div *ngIf="!(field.name == 'Phone Number')"> -->
                                                <div
                                                    *ngIf="!(field.name == 'Phone Number' ||  field.name == 'PhoneNo' || field.name == 'PhoneNo*'  || field.name == 'Phone No')">
                                                    <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                                        required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable">
                                                </div>
                                            </span>
                                            <span
                                            *ngIf="field.fld_Enable_Search==true && field.isUsed==true && myStudentFiledTrueFalse && !teacherFiledTrueFalse">
                                            <div
                                                *ngIf="field.name === 'Student Id' || field.name === 'Student Name' || field.name === 'Grade'">
                                                <div style="font-size:11px !important; margin-top:5px;">
                                                    <span style="padding-left:10px; ">{{field.name}}</span>
                                                </div>
                                                <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                                    required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                                    style="user-select: none !important;">
                                            </div>
                                        </span>
                                        <span
                                            *ngIf="field.fld_Enable_Search==true && field.isUsed==true && teacherFiledTrueFalse && !myStudentFiledTrueFalse">
                                            <div
                                                *ngIf="field.name === 'Teacher Code' || field.name === 'Teacher Name' || field.name === 'Registered Mobile Number'">
                                                <div style="font-size:11px !important; margin-top:5px;">
                                                    <span style="padding-left:10px; ">{{field.name}}</span>
                                                </div>
                                                <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                                    required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                                    style="user-select: none !important;">
                                            </div>
                                        </span>
                                            <span *ngIf="field.controlType.value == 2 && field.displayInClient==true && field.isUsed==true ">
                                                <ng-container *ngIf="!hideDropDownEnableDIsable">
                                                    <div *ngIf="field.name === 'School Code'">
                                                        <!-- <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                                            class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                                            required="field.required" placeholder="select" [readonly]="!field.isEditable"  (onSelect)="firstParentValue($event,field)" (onChange)="firstParentValue($event,field)"
                                                            [filter]="true" filterBy="label">
                                                        </p-dropdown> -->
                                                        <p-dropdown 
                                                        [options]="selctedSchoolCode" 
                                                        [(ngModel)]="schoolCodeValue" 
                                                        placeholder="Select" 
                                                    [editable]="true"
                                                        [ngModelOptions]="{standalone: true}"
                                                        [filter]="true" filterBy="sclCode"  (onFilter)="customFilterFunction($event)" (onClear)="ocClearData($event)"
                                                        optionLabel="sclCode" (onSelect)="checkValueAfterClick($event)" (onChange)="checkValueAfterClick($event)">
                                                        <ng-template pTemplate="selectedItem" let-selectedUser>
                                                            <div class="selectedUser-item">
                                                                <div>{{selectedUser.sclCode}}</div>
                                                            </div>
                                                        </ng-template></p-dropdown>
                                                    </div>
                                                    <ng-container>
                                                        <div *ngIf="field.name === 'School Name'">
                                                            <input type="text"   class="p-inputtext-sm" pInputText [(ngModel)]="schoolNameValue" [ngModelOptions]="{standalone: true}"/>
                                                        </div>
                                                        <div *ngIf="field.name === 'District'">
                                                            <input type="text"   class="p-inputtext-sm" pInputText [(ngModel)]="districtValue" [ngModelOptions]="{standalone: true}"/>
                                                        </div>
                                                        <div *ngIf="field.name === 'Block Name'">
                                                            <input type="text"   class="p-inputtext-sm" pInputText [(ngModel)]="blockNameValue" [ngModelOptions]="{standalone: true}"/>
                                                        </div>
                                                      </ng-container>
                                             
                                                </ng-container>
                                               <ng-container *ngIf="hideDropDownEnableDIsable && field.name != 'Designation' && field.name != 'Problem Reported' && field.name != 'Problem Category' && field.name != 'Dependent upon (State/CG)' &&  field.name != 'Bot Name'">
                                                <input type="text" pInputText [formControlName]="field.fld_FieldName" 
                                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                                style="user-select: none !important;"   >
                                             <span (click)="returnDropDownFirst" *ngIf="field.name === 'School Code'" style="    position: relative; 
                                             float: right;
                                             bottom: 43px;
                                             left: 6px;">
                                                <i class="pi pi-times-circle" style="font-size: 20px" (click)="returnDropDownFirst()" sty></i>
                                             </span>
                                               </ng-container>
                                               <ng-container *ngIf="hidePropertyValueEnable && field.name != 'Designation'   &&  field.name != 'Bot Name' && field.name != 'District' &&  field.name != 'School Name' && field.name != 'School Code' && field.name != 'Block Name'">
                                                <input type="text" pInputText [formControlName]="field.fld_FieldName" 
                                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                                style="user-select: none !important;"   >
                                             <span  (click)="returnDropDownSecond" *ngIf="field.name === 'Problem Reported'" style="    position: relative;
                                             float: right;
                                             bottom: 43px;
                                             left: 6px;">
                                                <i class="pi pi-times-circle" style="font-size: 20px" (click)="returnDropDownSecond()"></i>
                                             </span>
                                               </ng-container>
                                               <div *ngIf="field.name != 'District' &&  field.name != 'School Name' && field.name != 'School Code' && field.name != 'Block Name' && field.name != 'Problem Reported' && field.name != 'Problem Category' && field.name != 'Dependent upon (State/CG)'">
                                                <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"   (onSelect)="getingBotNameValue($event,field)"
                                                (onChange)="getingBotNameValue($event,field)"
                                                    class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                                    required="field.required" placeholder="select" [readonly]="!field.isEditable" 
                                                    [filter]="true" filterBy="label">
                                                </p-dropdown>
                                            </div>
                                            <ng-container *ngIf="!hidePropertyValueEnable">
                                                <div *ngIf="field.name === 'Problem Reported'">
                                                    <!-- <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                                        class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                                        required="field.required" placeholder="select" [readonly]="!field.isEditable"  (onSelect)="firstProblemDropDownValue($event,field)" (onChange)="firstProblemDropDownValue($event,field)"
                                                        [filter]="true" filterBy="label">
                                                    </p-dropdown> -->
                                                    <p-dropdown [options]="getValueParakhBot" [(ngModel)]="problemReportedValue"
                                                    [ngModelOptions]="{standalone: true}" optionLabel="value" optionValue="value" class="p-inputtext-sm"
                                                    placeholder="Select" (onSelect)="firstProblemDropDownValue($event,field)"
                                                    (onChange)="firstProblemDropDownValue($event,field)" [filter]="true"
                                                    filterBy="value">
                                                    <ng-template pTemplate="selectedItem" let-selectedUser>
                                                        <div class="selectedUser-item" style="width: 100px !important;">
                                                            <div>{{selectedUser.value}}</div>
                                                        </div>
                                                    </ng-template>
                                                </p-dropdown>
                                                </div>
                                                <div *ngIf="field.name === 'Problem Category' && mainProblemDropDownValue">
                                                    <p-dropdown [options]="ProblemCategoryArr" optionlabel="label" optionValue="value"
                                                        class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                                        required="field.required" placeholder="select" [readonly]="!field.isEditable" (onSelect)="ProblemCategoryVFun($event,field)" (onChange)="ProblemCategoryVFun($event,field)"
                                                        [filter]="true" filterBy="label">
                                                    </p-dropdown>
                                                </div>
                                                <div *ngIf="field.name === 'Problem Category' && !mainProblemDropDownValue">
                                                    <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                                        class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                                        required="field.required" placeholder="select" [readonly]="!field.isEditable" (onSelect)="ProblemCategoryVFun($event,field)" (onChange)="ProblemCategoryVFun($event,field)"
                                                        [filter]="true" filterBy="label">
                                                    </p-dropdown>
                                                </div>
                                                <div *ngIf="field.name === 'Dependent upon (State/CG)' && mainNewVariableCheckDepenedent">
                                                    <p-dropdown [options]="dependentVariavbles" optionlabel="label" optionValue="value"
                                                        class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                                        required="field.required" placeholder="select" [readonly]="!field.isEditable" (onSelect)="DependentuponFunc($event,field)" (onChange)="DependentuponFunc($event,field)"
                                                        [filter]="true" filterBy="label">
                                                    </p-dropdown>
                                                </div>
                                                <div *ngIf="field.name === 'Dependent upon (State/CG)' && !mainNewVariableCheckDepenedent">
                                                    <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                                        class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                                        required="field.required" placeholder="select" [readonly]="!field.isEditable" (onSelect)="DependentuponFunc($event,field)" (onChange)="DependentuponFunc($event,field)"
                                                        [filter]="true" filterBy="label">
                                                    </p-dropdown>
                                                </div>
                                            </ng-container>
                                         
                                            </span>
                    
                                            <span *ngIf="field.controlType.value == 3 && field.displayInClient==true && field.isUsed==true">
                                                <div>
                                                    <p-checkbox binary="true" inputId="binary" [formControlName]="field.fld_FieldName"
                                                        required="field.required" [readonly]="!field.isEditable">
                                                    </p-checkbox>
                                                </div>
                                            </span>
                    
                                            <span *ngIf="field.controlType.value == 4 && field.displayInClient==true && field.isUsed==true">
                                                <div>
                                                    <p-radioButton [formControlName]="field.fld_FieldName" required="field.required"
                                                        [readonly]="!field.isEditable">
                                                    </p-radioButton>
                                                </div>
                                            </span>
                    
                                            <span *ngIf="field.controlType.value == 5 && field.displayInClient==true && field.isUsed==true">
                                                <div>
                                                    <p-listbox [formControlName]="field.fld_FieldName" optionLabel="name"
                                                        required="field.required" [readonly]="!field.isEditable"></p-listbox>
                                                </div>
                                            </span>
                    
                                            <span *ngIf="field.controlType.value == 1 && field.displayInClient==true && field.isUsed==true">
                                                <div>
                                                    <textarea pInputTextarea [formControlName]="field.fld_FieldName"
                                                        required="field.required" [readonly]="!field.isEditable"></textarea>
                                                </div>
                                            </span>
                    
                                            <span *ngIf="field.controlType.value == 8 && field.displayInClient==true && field.isUsed==true">
                                                <div>
                                                    <p-multiSelect [options]="cities" class="p-inputtext-sm" optionLabel="name"
                                                        required="field.required" [formControlName]="field.fld_FieldName"
                                                        placeholder="select" [readonly]="!field.isEditable"></p-multiSelect>
                                                </div>
                                            </span>
                                        </div>
                                    </ng-container>
                                </div>
                                <!-- <div class="field col-12 md:col-5 flex">
                                    <p-button label="New Ticket" (onClick)="newTicket()" [hidden]="!ticketEnable"></p-button>
                                    <div style="margin: 0 5px;"></div>
                                    <p-button label="Open DM Chat" (click)="dmChat()" [hidden]="!liveDM"></p-button>
                                </div> -->
                            </div>
                        </div>
                    </form>
                        </div>
                    </div>
            </div>
                <div class="cardTicket" *ngIf="showTicketCard">
    
                    <!-- assign by && Ticket Status -->
                    <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                        <div class="col-12 mb-0 md:col-2 md:mb-0">Assigned By:<span style="color:red">*</span></div>
                        <div class="col-12 mb-0 md:col-3 md:mb-0">
                            <input type="text" pInputText [(ngModel)]="selectedAssignedBy" readonly="true"
                                class="p-inputtext-sm" />
                        </div>
    
                        <div class="col-12 mb-0 md:col-2 md:mb-0">Ticket Status<span style="color:red">*</span></div>
                        <div class="col-12 mb-0 md:col-3 md:mb-0">
                            <p-dropdown class="p-inputtext-sm" id="ticketStatus" [options]="ticketStatusDropdownData"
                                [disabled]="disabledTicketFields" [filter]="true" filterBy="label" optionLabel="label"
                                optionValue="value" [(ngModel)]="selectedticketStatus" [showClear]="true"
                                placeholder="Select" (onClick)="getTicketStatus()">
                                <ng-template let-selectedType pTemplate="item">
                                    <div class="selectedType-item">
                                        <div>{{selectedType.label}}</div>
                                    </div>
                                </ng-template>
                            </p-dropdown>
                        </div>
                    </div>
    
                    <!-- ticket type -->
                    <!-- <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                        <div class="col-12 mb-0 md:col-2 md:mb-0 ">Ticket Type:<span style="color:red">*</span></div>
                        <div class="col-12 mb-0 md:col-4 md:mb-0 flex flex-row">
                            <i class="pi pi-chevron-circle-left" style="font-size: 1.7rem"
                                (click)="previousIconTicketType()"></i>
                            <p-dropdown class="p-inputtext-sm" id="ticketType" [options]="ticketTypeDropdownData"
                                appendTo="body" [disabled]="disabledTicketFields" [filter]="true" filterBy="label"
                                optionLabel="label" optionValue="value" [(ngModel)]="selectedTicketType" [showClear]="true"
                                placeholder="Select ">
                                <ng-template let-selectedType pTemplate="item">
                                    <div class="selectedType-item">
                                        <div>{{selectedType.label}}</div>
                                    </div>
                                </ng-template>
                            </p-dropdown>
                            <i class="pi pi-chevron-circle-right" style="font-size: 1.7rem"
                                (click)="forwardIconTicketType()"></i>
                        </div>
                    </div> -->
    
                  <ng-container *ngIf="newVariableFalseTrueCheck">
                    <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                        <div class="col-12 mb-0 md:col-2 md:mb-0 ">Ticket Type:<span style="color:red">*</span></div>
                        <div class="col-12 mb-0 md:col-3 md:mb-0 flex flex-row" *ngFor="let item of arrObj; let i = index">
                            <p-dropdown class="p-inputtext-sm" id="ticketType[i]" [options]="ticketTypeDropdownData[i]"
                                [disabled]="disabledTicketFields" appendTo="body" [filter]="true" filterBy="label"
                                optionLabel="label" optionValue="value" [(ngModel)]="selectedTicketType[i] "
                                [showClear]="true" placeholder="Select" (onChange)="ticketTypeDropdown(i)">
                                <ng-template let-selectedType pTemplate="item">
                                    <div class="selectedType-item">
                                        <div>{{selectedType.label}}</div>
                                    </div>
                                </ng-template>
                            </p-dropdown>
                        </div>
    
                    </div>
    
                    <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                        <div class="col-12 mb-0 md:col-12 md:mb-0">Tree : {{tree}}</div>
    
                    </div>
    
                    <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;"
                        *ngIf="voicefile">
                        <div class="col-12 mb-0 md:col-2 md:mb-0">Voice File:</div>
                        <div class="col-12 mb-0 md:col-6 md:mb-0">
                            <audio controls>
                                <source [src]="voicefile" type="audio/wav">
                            </audio>
                        </div>
                    </div>
                  </ng-container>
    
                    <!-- agent remarks && moved to below just above the callback section -->
                    <!-- <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                        <div class="col-12 mb-0 md:col-2 md:mb-0">Agent Remarks:</div>
                        <div class="col-12 mb-0 md:col-6 md:mb-0">
                            <textarea rows="2" cols="40" id="agentRemarks" name="agentRemarks" pInputTextarea
                                [disabled]="disabledTicketFields" placeholder=" " [(ngModel)]="agentRemarks"></textarea>
                        </div>
                    </div> -->
                </div>
    
                <div class="cardTicket" *ngIf="showDynaTicketCard">
                    <form [formGroup]="ticketForm">
                        <div>
                            <div class="dynamic-form-card">
                                <div class="p-fluid formgrid grid" style="padding-left: 10px !important; margin-top:10px;">
                                    <ng-container *ngFor="let field of ticketFields">
                                        <div *ngIf="field.fld_isNewRow==true"
                                            style="min-inline-size: -webkit-fill-available !important;">
                                        </div>
                                        <div class="field col-12 md:col-12" *ngIf="field.isSeparator==true">
                                            <div class="flex flex-wrap">
                                                <span>{{field.separatorText}}</span>
                                                <span class="remaining-space"></span>
                                            </div>
                                        </div>
                                        <div style="font-size:11px !important; margin-top:5px;"
                                            class="field col-12 md:col-2">
                                            <span>{{field.name}}</span>
                                        </div>
                                        <div class="field col-12 md:col-2">
                                            <span
                                                *ngIf="field.controlType.value == 0 && field.displayInClient==true && field.isUsed==true && field.isUsed==true">
                                                <div *ngIf="field.name === 'Phone Number'">
                                                    <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                                        required="field.required" class="p-inputtext-sm">
                                                </div>
    
                                                <div *ngIf="!(field.name == 'Phone Number')">
                                                    <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                                        required="field.required" class="p-inputtext-sm">
                                                </div>
    
                                            </span>
    
                                            <span
                                                *ngIf="field.controlType.value == 3 && field.displayInClient==true && field.isUsed==true">
                                                <div>
    
                                                    <p-checkbox binary="true" inputId="binary"
                                                        [formControlName]="field.fld_FieldName" required="field.required">
                                                    </p-checkbox>
                                                </div>
    
                                            </span>
    
                                            <span
                                                *ngIf="field.controlType.value == 4 && field.displayInClient==true && field.isUsed==true">
                                                <div *ngFor="let radioOption of field.selectItems">
                                                    <p-radioButton binary="true" inputId="binary"
                                                        [value]="radioOption.value"
                                                        [formControlName]="field.fld_FieldName"></p-radioButton>
                                                    <label class="ml-2">{{ radioOption.label }}</label>
                                                </div>
                                            </span>
    
                                            <span
                                                *ngIf="field.controlType.value == 7 && field.displayInClient==true && field.isUsed==true">
                                                <div>
                                                    <p-calendar [formControlName]="field.fld_FieldName" optionLabel="name"
                                                        required="field.required"></p-calendar>
                                                </div>
                                            </span>
    
                                            <span
                                                *ngIf="field.controlType.value == 1 && field.displayInClient==true && field.isUsed==true">
                                                <div>
                                                    <textarea pInputTextarea [formControlName]="field.fld_FieldName"
                                                        required="field.required"></textarea>
                                                </div>
                                            </span>
    
                                            <!-- <span
                                                *ngIf="field.controlType.value == 5 && field.displayInClient==true && field.isUsed==true">
                                                <div>
                                                    <p-multiSelect [options]="field.selectItems" class="p-inputtext-sm"
                                                        optionLabel="label" optionValue="value" required="field.required"
                                                        [formControlName]="field.fld_FieldName"
                                                        defaultLabel="Select a City"></p-multiSelect>
                                                </div>
                                            </span> -->
                                            <span
                                                *ngIf="field.controlType.value == 5 && field.displayInClient==true && field.isUsed==true">
                                                <div>
                                                    <p-multiSelect [options]="field.selectItems" class="p-inputtext-sm"
                                                        optionLabel="label" optionValue="value"
                                                        [formControlName]="field.fld_FieldName"
                                                        defaultLabel="Select Value"></p-multiSelect>
                                                </div>
    
                                            </span>
    
                                          
    
                                            <span
                                                *ngIf="field.controlType.value == 8 && field.displayInClient == true && field.isUsed == true">
                                                <div *ngFor="let category of field.selectItems" class="field-checkbox">
                                                    <p-checkbox name="group" [value]="category.value" [(ngModel)]="abc"
                                                        [formControlName]="field.fld_FieldName"
                                                        [inputId]="category.key"></p-checkbox>
                                                    <label [for]="category.key">{{ category.label }}</label>
    
                                                </div>
                                                <!-- {{category.value |json}} -->
                                            </span>
    
    
                                            <span
                                                *ngIf="field.controlType.value == 2 && field.displayInClient==true && field.isUsed==true">
                                                <div>
                                                    <p-dropdown [options]="field.selectItems" optionlabel="label"
                                                        optionValue="value" class="p-inputtext-sm"
                                                        [formControlName]="field.fld_FieldName" required="field.required"
                                                        placeholder="select" [filter]="true" filterBy="label">
                                                    </p-dropdown>
                                                </div>
                                            </span>
                                        </div>
    
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </form>
    
                </div>
    
                <div class="cardTicket" *ngIf="showTicketCard">
                    <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                        <div class="col-12 mb-0 md:col-2 md:mb-0">Agent Remarks:</div>
                        <div class="col-12 mb-0 md:col-6 md:mb-0">
                            <textarea rows="2" cols="40" id="agentRemarks" name="agentRemarks" pInputTextarea
                                [disabled]="disabledTicketFields" placeholder=" " [(ngModel)]="agentRemarks"></textarea>
                        </div>
                    </div>
                </div>
    
    
                <div class="cardTicket" *ngIf="showTicketCard">
                    <!-- <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                        <div class="col-12 mb-0 md:col-2 md:mb-0">CallBack</div>
                        <div class="col-12 mb-0 md:col-1 md:mb-0">
                            <p-checkbox name="selectedCallBack" [binary]="true" [(ngModel)]="selectedCallBack"></p-checkbox>
                        </div>
    
                        <div class="col-12 mb-0 md:col-2 md:mb-0">CallBack
                            Time</div>
                        <div class="col-12 mb-0 md:col-2 md:mb-0">
                            <p-calendar [(ngModel)]="date" [showTime]="true" timeFormat="'hh:mm:ss a'" hourFormat="12"
                                [showSeconds]="true" id="iscallbackyes" inputId="time"></p-calendar>
                        </div>
    
                        <div class="col-12 mb-0 md:col-2 md:mb-0">Assigned
                            To</div>
                        <div class="col-12 mb-0 md:col-2 md:mb-0">
                            <p-dropdown inputId="state" [options]="AssignedBy" [(ngModel)]="selectedAssignedTo"
                                placeholder="Select" optionLabel="name" optionValue="name" [filter]="true" filterBy="label">
                            </p-dropdown>
                        </div>
                        <div class="p-field-checkbox" style="margin-top:10px;">
                            <span style="padding-left:10px;"></span>
                                <label
                                style="font-size: 11px;"
                                for="ny">Redial
                                </label>&nbsp;&nbsp;&nbsp;
                                <p-radioButton inputId="griup" value=2
                                [(ngModel)]="selectedDisposeCall"></p-radioButton>
            
            
            
                        </div>
                    </div> -->
    
                    <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
    
                        <!-- <div class="col-12 mb-0 md:col-1 md:mb-0">
                            <div>TicketNo</div>
                        </div> -->
                        <!-- <div class="col-12 mb-0 md:col-2 md:mb-0">
                            <div><input class="p-inputtext-sm" type="text" pInputText [(ngModel)]="ticketNo" /></div>
                        </div> -->
    
                        <!-- <div class="col-12 mb-0 md:col-2 md:mb-0">
                            <button (click)="callHistory()" pButton pRipple type="button" label="Ticket History">
                            </button>
                        </div> -->
                        <div class="col-12 mb-0 md:col-2 md:mb-0">
                            <button pButton pRipple type="submit" label="Save" (click)="saveDynamicLeadCustField();"
                                *ngIf="showSaveButton">
                            </button>
    
                            <button pButton (click)="updateTiecket()" pButton pRipple type="Update" label="Update"
                                *ngIf="showUpdateButton">
                            </button>
    
                        </div>
                        <!-- <div class="col-12 mb-0 md:col-2 md:mb-0" *ngIf="showDisposeButton">
                            <button pButton pRipple type="submit" (click)="saveDispositionForm()" [disabled]="disposeCall"
                                label="Dispose Call">
                            </button>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-container>
 


    <div class="col-12 flex column-gap-3 justify-content-end">
        <button pButton pRipple type="button" class="p-button-primary h-3rem w-full sm:w-auto" icon="pi pi-send" [disabled]="!emailStringData"
            label="Draft" (click)="draftMail()"></button> &nbsp;&nbsp;&nbsp;
        <!-- <button pButton pRipple type="button" class="p-button-primary h-3rem w-full sm:w-auto" icon="pi pi-send"   [hidden]="!ticketEnable" [disabled]="!valueSaveTrue"
            label="Send" (click)="sendMail()"></button> -->
        <button pButton pRipple type="button" class="p-button-primary h-3rem w-full sm:w-auto" icon="pi pi-send"  [hidden]="ticketEnable"  [disabled]="!emailStringData"
            label="Send" (click)="sendMail()"></button>
    </div>
</div>

<p-dialog position="center" [(visible)]="historyDialogBox" [style]="{width: '85vw'}" header="Ticket History"
    [modal]="true" styleClass="p-fluid">
    <div *ngFor="let ticketHistory of ticketTypeHistory">
        <div class="cardTicket" style="background-color:rgb(3, 83, 136);">
            <ul style="display: flex; color:white; margin-top:0rem; margin-bottom:0rem; padding-left:0.5rem;    font-size: 14px;">
                <li>TicketNo: {{ticketHistory.ticketID}}</li>
                <span style="margin-left:40px;"></span>
                <li>Source: {{ticketHistory.sourceName}}</li>
                <span style="margin-left:40px;"></span>
                <li>Campaign: {{ticketHistory.campName}}</li>
                <span style="margin-left:40px;"></span>
                <li>ActionNo: {{ticketHistory.action_No}}</li>
                <span style="margin-left:40px;"></span>
                <li>Ticket Time: {{ticketHistory.ticket_Time}}</li>
                <span style="margin-left:40px;"></span>
                <li>Duration: {{ticketHistory.ticketTime}}</li>
            </ul>

        </div>
        <div class="cardTicket">

            <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-2 md:mb-0">Ticket Start Time<span style="color:red">*</span> :</div>
                <div class="col-12 mb-0 md:col-2 md:mb-0">
                    <input type="text" pInputText [(ngModel)]="ticketHistory.start_Time" readonly="true"
                        class="p-inputtext-sm" />
                </div>
                <div class="col-12 mb-0 md:col-2 md:mb-0">Ticket End Time<span style="color:red">*</span> :</div>
                <div class="col-12 mb-0 md:col-2 md:mb-0">
                    <input type="text" pInputText [(ngModel)]="ticketHistory.ticketElapsedTime" readonly="true"
                        class="p-inputtext-sm" />
                </div>
                <div class="col-12 mb-0 md:col-2 md:mb-0">Duration<span style="color:red">*</span> :</div>
                <div class="col-12 mb-0 md:col-2 md:mb-0">
                    <input type="text" pInputText [(ngModel)]="ticketHistory.ticketTime" readonly="true"
                        class="p-inputtext-sm" />
                </div>
            </div>

            <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-2 md:mb-0 ">Ticket Type<span style="color:red">*</span>:</div>
                <div class="col-12 mb-0 md:col-2 md:mb-0">
                    <input type="text" pInputText [(ngModel)]="ticketHistory.ticket_type_name" readonly="true"
                        class="p-inputtext-sm" />
                </div>


                <div class="col-12 mb-0 md:col-2 md:mb-0">Ticket Status<span style="color:red">*</span></div>
                <div class="col-12 mb-0 md:col-2 md:mb-0">
                    <input type="text" pInputText [(ngModel)]="ticketHistory.ticket_StatusName" readonly="true"
                        class="p-inputtext-sm" />
                </div>


                <div class="col-12 mb-0 md:col-2 md:mb-0">Assigned By<span style="color:red">*</span>:</div>
                <div class="col-12 mb-0 md:col-2 md:mb-0">
                    <input type="text" pInputText [(ngModel)]="ticketHistory.assignedByID" readonly="true"
                        class="p-inputtext-sm" />
                </div>
            </div>


            <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-2 md:mb-0">UpdateBy<span style="color:red">*</span>:</div>
                <div class="col-12 mb-0 md:col-2 md:mb-0">
                    <input type="text" pInputText [(ngModel)]="ticketHistory.updatedByID" readonly="true"
                        class="p-inputtext-sm" />
                </div>

                <div class="col-12 mb-0 md:col-2 md:mb-0">Tree :</div>
                <div class="col-12 mb-0 md:col-6 md:mb-0">

                </div>
            </div>

            <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;"
                *ngIf="ticketHistory.voicefile">
                <div class="col-12 mb-0 md:col-2 md:mb-0">Voice File:</div>
                <div class="col-12 mb-0 md:col-6 md:mb-0">
                    <audio controls>
                        <source [src]="ticketHistory.voicefile" type="audio/wav">
                    </audio>
                </div>
            </div>

            <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-2 md:mb-0">Agent Remarks:</div>
                <div class="col-12 mb-0 md:col-6 md:mb-0">
                    <textarea rows="2" cols="40" id="agentRemarks" name="agentRemarks" pInputTextarea
                        [disabled]="disabledTicketFields" placeholder=" "
                        [(ngModel)]="ticketHistory.remarks"></textarea>
                </div>
            </div>

            <!-- <form [formGroup]="ticketHistoryForm" *ngIf="ticketHistory.objticketDynaField"> -->
            <div *ngIf="ticketHistory.objticketDynaField">
                <div class="dynamic-form-card">
                    <div class="p-fluid formgrid grid" style="padding-left: 10px !important; margin-top:10px;">

                        <ng-container *ngFor="let field of ticketHistory.objticketDynaField | keyvalue">
                            <div *ngIf="field.value.fld_isNewRow==true"
                                style="min-inline-size: -webkit-fill-available !important;">
                            </div>
                            <div class="field col-12 md:col-12" *ngIf="field.value.isSeparator==true">
                                {{field.value.separatorText}}</div>
                            <div style="font-size:11px !important; margin-top:5px;" class="field col-12 md:col-2">
                                <span>{{field.value.name}}</span>
                            </div>
                            <div class="field col-12 md:col-2">
                                <span
                                    *ngIf="field.value.controlType.value == 0 && field.value.displayInClient==true && field.value.isUsed==true && field.value.isUsed==true || 
                                        field.value.controlType.value == 2 && field.value.displayInClient==true && field.value.isUsed==true || field.value.controlType.value == 7 && field.value.displayInClient==true && field.value.isUsed==true ||
                                        field.value.controlType.value == 5 && field.value.displayInClient==true && field.value.isUsed==true">

                                    <div *ngIf="field.value.name === 'Phone Number'">
                                        <input type="text" pInputText required="field.value.required"
                                            class="p-inputtext-sm" [(ngModel)]="field.value.value" readonly="true">
                                    </div>
                                    <div *ngIf="!(field.value.name == 'Phone Number')">
                                        <input type="text" pInputText required="field.value.required"
                                            class="p-inputtext-sm" [(ngModel)]="field.value.value" readonly="true">
                                    </div>

                                </span>

                                <span *ngIf="field.value.controlType.value == 8">
                                    <div *ngFor="let category of field.value.selectItems" class="field-checkbox">
                                        <p-checkbox name="group" [value]="category.value"
                                            [(ngModel)]="field.value.value" readonly="true"></p-checkbox>
                                        <label [for]="category.key">{{ category.label }}</label>
                                    </div>
                                    <!-- {{category.value |json}} -->
                                </span>
                                <span
                                    *ngIf="field.value.controlType.value == 3 && field.value.displayInClient==true && field.value.isUsed==true">
                                    <div>
                                        <!-- {{field.value.value|json}} -->
                                        <p-checkbox binary="true" inputId="binary" required="field.value.required"
                                            [ngModel]="field.value.value === 'true'" readonly="true">
                                        </p-checkbox>
                                    </div>
                                </span>

                                <span *ngIf="field.value.controlType.value == 4">
                                    <div *ngFor="let radioOption of field.value.selectItems">
                                        <p-radioButton inputId="{{ radioOption.value }}" value="{{ radioOption.value }}"
                                            [(ngModel)]="field.value.value" disabled="true"></p-radioButton>
                                        <label class="ml-2">{{ radioOption.label }}</label>
                                    </div>
                                </span>

                                <!-- <span *ngIf="field.value.controlType.value == 7 && field.value.displayInClient==true && field.value.isUsed==true">
                                        <div>
                                            <p-calendar optionLabel="name"
                                                required="field.value.required"></p-calendar>
                                        </div>
                                    </span> -->

                                <span
                                    *ngIf="field.value.controlType.value == 1 && field.value.displayInClient==true && field.value.isUsed==true">
                                    <div>
                                        <textarea pInputTextarea required="field.value.required"
                                            [(ngModel)]="field.value.value" readonly="true"></textarea>
                                    </div>
                                </span>
                            </div>

                        </ng-container>
                    </div>
                </div>
            </div>
            <!-- </form> -->
        </div>
        <div style="margin-top:10px;"></div>
    </div>
</p-dialog>