<p-toast></p-toast>
<div class="container">
  <!-- Sidebar start-->
  <div class="sidebar" [ngStyle]="sideBarMange1 ? {'display': 'block'} : {'display': 'none'}">
  <!-- <div class="sidebar" [ngStyle]="sideBarMange ? {'display': 'block'} : {'display': 'none'}"> -->
    <div class="flex mb-2">
      <span class="p-input-icon-left" *ngIf="showMobile" style="width: 70%;">
        <input type="text" id="selectInput" pInputText placeholder="Search" class="w-full" [(ngModel)]="searchValue"
          style="padding-left: 0.5rem  !important;" autocomplete="off" (keyup.enter)="searchFromDB()" />
      </span>

      <span class="flex flex-wrap new" (click)="newNumber()" style="cursor: pointer;">
        <img src="assets/images/new-chat.png" tooltipPosition="bottom" pTooltip="New Conversation" class="new-chat-css" alt="New">
        <!-- <nav>New</nav> -->
      </span>
    </div>
    <span *ngIf="filteredUsers && filteredUsers[0] && filteredUsers[0].businessId && showBusinessNumber" style="margin-top: -7px;    font-size: 12px;">
      Business No :  {{filteredUsers[0].businessId}}
    </span>
    <div class=" flex-row mb-1 gap-4 md:flex-column overflow-auto">
      <div class="card1 flex flex-wrap col-12 mb-0 md:col-12 md:mb-0"
        [ngClass]="{'active-tab': user.phoneNumber === activeUser}" style="margin: 0; padding: 0;"
        *ngFor="let user of filteredUsers  | searchvalue: searchValue;"
        (click)="sendMobile(user.phoneNumber, '1');newFun(user)" (click)="sendSession(user.inchat)">
        <div class="col-12 mb-0 md:col-9 md:mb-0" style="padding: 4px 15px;position: relative;">
          <div [ngStyle]="getAvatarStyle(user.phoneNumber)">
            {{ user.phoneNumber.substring(2, 4) }} <!-- Display part of the phone number as avatar text -->
          </div>
          <span [ngClass]="user.inchat ? 'colorInChatSetTrue' : 'colorInChatSetFalse'"></span>
          <span style="font-weight: bold;    position: relative;
    left: 15px;" *ngIf="ismaskphonenoValue">{{ user.maskphoneno }}</span>
          <span style="font-weight: bold;    position: relative;
    left: 15px;" *ngIf="!ismaskphonenoValue">{{ user.phoneNumber }}</span>
          <p class="truncate-text" style="margin: 0; padding: 0;    position: relative;font-size: 12px;
    left: 15px;">
            {{ user.messages[0]=='null' ? 'Media' : user.messages[0] || '' }}</p>
        </div>
        <div class="col-12 mb-0 md:col-3 md:mb-0" style="padding: 0;
        padding-top: 7px;
        display: flex;
        flex-direction: column;
        line-height: 11px;">
          <span [ngClass]="{'unread': user.unreadcount > 0}">
            {{ user.unreadcount }} </span>
        </div>

      </div>
    </div>
  </div>
  <div class="chat-area" style="background-image: url('assets/images/bg-image.jpg'); height: 100%;">
    <div>
      <div class="flex align-items-center border-bottom-1 surface-border p-3 lg:p-6"
        [ngClass]="sideBarMange ? 'my_class1' : 'my_class2'" *ngIf="number">
        <span (click)="manageDataSideBAr()" style="cursor: pointer;"  >
          <i class="pi pi-bars" style="    color: #128c7e;
          font-weight: 600;
          font-size: 20px;"></i>
        </span>
        <div class="relative flex align-items-center mr-3" [ngStyle]="getAvatarStyle(number)"
          style="margin-left: 20px;border-radius: 100%;">
          <!-- <img src="assets/images/user.png" alt="user.name" class="w-2rem h-2rem border-circle shadow-4"
            style="padding: 7px;"> -->
            <i class="pi pi-user w-2rem h-2rem border-circle shadow-4" style="font-size: 2rem" 
            style="padding: 7px;color: #fff;"></i>
        </div>
        <div class="mr-2" style="display: flex;">
          <span class="text-900 font-semibold block" style="color: black !important;"
            *ngIf="newPhoneNumberDetails">{{newPhoneNumberDetails}} ({{mainRowId}})</span>
          <span class="text-900 font-semibold block" style="color: black !important;"
            *ngIf="!newPhoneNumberDetails">{{formatPhoneNumber(number)}} ({{mainRowId}})</span>
          <span (click)="RedialNumber()" class="whastappIcon" style="    height: 24px;
    width: 24px;"  tooltipPosition="bottom" pTooltip="Make Call">
            <i class="material-icons" style="    color: #fff;
  position: relative;
  left: 5px;
  top: 3px;font-size: 12px !important;">add_ic_call</i>
          </span>
        </div>
        <div class="flex align-items-center ml-auto">
          <div class="mr-1 addMobileCls" *ngIf="showFaqDetails" (click)="getFaqDetails()">
            <a rel="noopener noreferrer" class="inatagCss">
              <button pButton label="FAQ's" class="w-full sm:w-auto" [raised]="true" 
                style="padding: 6px; font-size: 12px;     border-radius: 100px; background: #0ea5e9 !important;
    border: 1px solid #0ea5e9 !important;">
              </button>
            </a>
          </div>
          <div class="mr-1 addMobileCls" *ngIf="contactSharing">
            <button pButton label="Send Contact" class="w-full sm:w-auto" (click)="sendBusinessContact()" [raised]="true"
              tooltipPosition="bottom" pTooltip="Send Business Contact" style="    padding: 6px;
                font-size: 12px;
                    border-radius: 100px;    background: #f97316 !important;
                border: 1px solid #f97316  !important;
            "></button>
          </div>
          <div class="mr-1 addMobileCls" *ngIf="smsApi">
            <button pButton label="Send Invite" class="w-full sm:w-auto" (click)="sendInviteApi($event)" [raised]="true"
              tooltipPosition="bottom" pTooltip="Send Invitation On SMS" style="    padding: 6px;
                font-size: 12px;
                    border-radius: 100px;    background: #a855f7 !important;
                border: 1px solid #a855f7 !important;
            "></button>
          </div>
          <span>
            <i class="pi pi-ellipsis-h" style="margin-left: 5px; cursor: pointer;    font-weight: bold;
    font-size: 20px;
" (click)="opTop.toggle($event);"></i>
          </span>
        </div>
      </div>
    </div>
    <div class="chat-messages" *ngIf="number" [ngStyle]="!sideBarMange ? {'display': 'flex'} : {'display': 'block'}">
      <!-- Chat messages will go here -->
      <!-- <div style="margin-top: 8em;margin-left: 6em;" (click)="emaildialogTrue()"  >
  somya.tyagi@novusconnect.in
</div> -->
      <div style="height: calc(100% - 48px);" [ngStyle]="!sideBarMange ? {'width': '30%'} : {'width': '100%'}">
        <div class="p-3 md:px-4 lg:px-6 lg:py-4  overflow-y-auto" style="height: 100%;" #chatWindow
          (scroll)="onScroll($event);">
          <!-- <div *ngFor="let message of listChats"> -->
          <div *ngFor="let message of completeArray">
            <div class="grid grid-nogutter mb-0">
              <div class="col mt-1" *ngIf="message.received; else notReceived">

                <!-- text -->
                <span *ngIf="(message.messagetype && message.messagereplyText)" class="maintext"
                  style="display: flex;">
                  <span *ngIf="message.messagetype" (contextmenu)="onImageRightClick($event, message)"
                    class="sendedtext2 inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                    <span>
                      <span
                        *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true &&  message.replymessagetype == 'text')"
                        class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        {{ message.messagereplyText }}
                      </span>
                      <span
                        *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true &&  message.replymessagetype == 'template')"
                        class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        {{ message.messagereplyText }}
                      </span>
                      <span
                        *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true &&  message.replymessagetype == 'bot')"
                        class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        {{ message.messagereplyText }}
                      </span>
                      <span
                        *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true &&  message.replymessagetype == 'image')"
                        class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <img [src]="message.messagereplyText && (message.messagereplyText.startsWith('http') || message.messagereplyText.startsWith('https')) 
                        ? message.messagereplyText 
                        : 'assets/images/back-jp-wh.jpg'" class=" border-square shadow-4" style="    width: 30px !important;
    height: 30px !important;">
                      </span>
                      <span
                        *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true &&  message.replymessagetype == 'document')"
                        class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <img src="assets/images/doc.png"  style="height: 30px; width: 30px;" class="border-square shadow-4">
                      </span>
                      <span
                        *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true &&  message.replymessagetype == 'video')"
                        class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <img src="assets/images/video.png"  style="height: 30px; width: 30px;" class="border-square shadow-4">
                      </span>
                      <span
                        *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true &&  message.replymessagetype == 'audio')"
                        class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <img src="assets/images/audio.jpg"  style="height: 30px; width: 30px;" class="border-square shadow-4">
                      </span>
                      <span
                        *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true &&  message.replymessagetype == 'location')"
                        class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <img src="assets/images/images/location-logo.jpg"  style="height: 30px; width: 30px;" class="border-square shadow-4">
                      </span>
                      <span
                        *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true &&  message.replymessagetype == 'contacts')"
                        class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <img src="assets/images/images/new-contact.png"  style="height: 30px; width: 30px;" class="border-square shadow-4">
                      </span>
                      <br>
                    </span>
                    <span style="padding: 8px 8px 0px 8px;" [innerHTML]="message.messageText | linkify"
                      (click)="getMessageDetailsNew(message)">
                      <!-- {{message.messageText }} -->
                    </span>
                  </span>

                  <span>
                    <i class="pi pi-ellipsis-h" style="margin-left: 5px; cursor: pointer;"
                      (click)="op.toggle($event); sendData(message)"></i>
                  </span>
                </span>

                <span *ngIf="message.messagetype == 'text' && !message.messagereplyText"
                  (contextmenu)="onImageRightClick($event, message)"
                  class="sendedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round"
                  style="word-break: break-word; max-width:80%; background: #fff !important; color: black !important; padding: 8px 10px !important;font-size: 12px;">
                  <!-- {{message.messageText }} -->
                  <span [innerHTML]="message.messageText | linkify" (click)="getMessageDetailsNew(message)">

                  </span>
                </span>
                <!-- image -->
                <span class="repliedtext1 rel1" *ngIf="message.messagetype == 'image' &&  !message.messagereplyText">
                  <a *ngIf="message.messagetype == 'image' && !message.isdownload" style="position: relative;">
                    <span *ngIf="!message.isdownload" class="addIconSpan">
                      <i *ngIf="!myImageIconVariable[message.mediaid]" class="pi pi-download" style="font-size: 2.5rem;
                position: absolute;
                top: 38%;
            " (click)="getDownloadData(message.mediaid)"></i>
                      <i *ngIf="myImageIconVariable[message.mediaid]" class="pi pi-spin pi-spinner" style="font-size: 2rem;  position: absolute;
                top: 38%;"></i>
                    </span>

                    <img src="assets/images/back-jp-wh.jpg" class="w-13rem h-16rem border-square shadow-4" />
                    <br>
                    <nav style="color: #000 !important;">{{ message.messageText !== null && message.messageText !==
                      'null'
                      ? message.messageText : ' ' }}</nav>
                  </a>
                  <a *ngIf="message.messagetype == 'image' && message.isdownload" [href]="message.mediaurl"
                    style="position: relative;" target="_blank" (contextmenu)="onImageRightClick($event, message)">
                    <span *ngIf="!message.isdownload" class="addIconSpan">
                      <i *ngIf="myImageIconVariable[message.mediaid]" class="pi pi-download" style="font-size: 2.5rem;color: #128c7e;
                position: absolute;
                top: 38%;
            " (click)="getDownloadData(message)"></i>
                      <i *ngIf="myImageIconVariable[message.mediaid]" class="pi pi-spin pi-spinner" style="font-size: 2rem;  position: absolute;
                top: 38%;"></i>

                    </span>
                    <img [src]="message.mediaurl" class="w-13rem h-16rem border-square shadow-4" />
                    <br>
                    <nav style="color: #000 !important;">{{ message.messageText !== null && message.messageText !==
                      'null'
                      ? message.messageText : ' ' }}</nav>
                  </a>
                </span>

            <ng-container *ngIf="!message.isdownload">
                  <!-- documents -->
                  <span [href]="message.mediaurl" *ngIf="message.messagetype == 'document' &&  !message.messagereplyText" (click)="getDownloadData(message.mediaid)"
                 
                  >
                  <span *ngIf="!message.isdownload" class="addedAUdioCss">
                    <i *ngIf="!myImageIconVariable[message.mediaid]" class="pi pi-download" style="font-size: 2rem;color: #249487;cursor: pointer;    position: relative;
    bottom: 34px;
          " (click)="getDownloadData(message)"></i>
                    <i *ngIf="myImageIconVariable[message.mediaid]" class="pi pi-spin pi-spinner" style="font-size: 2rem;color: #249487;cursor: pointer;    position: relative;
    bottom: 34px;"></i>
 <img src="assets/images/doc.png"
 style="width: 150px; margin-left: 9px;">
                  </span>
                 
                  <a [href]="message.mediaurl" download="{{ message.filename }}" target="_blank" style="color: #000;">{{
                    message.filename }}</a>
                </span>

                <!-- audio -->
                <span *ngIf="message.messagetype === 'audio' &&  !message.messagereplyText" (click)="getDownloadData(message.mediaid)">
                  <span *ngIf="!message.isdownload" class="addedAUdioCss">
                    <i *ngIf="!myImageIconVariable[message.mediaid]" class="pi pi-download" style="font-size: 2rem;color: #249487;cursor: pointer;    position: relative;
    bottom: 9px;
          " (click)="getDownloadData(message)"></i>
                    <i *ngIf="myImageIconVariable[message.mediaid]" class="pi pi-spin pi-spinner" style="font-size: 2rem;color: #249487; position: relative;
    bottom: 9px;"></i>
 <img src="assets/images/audio.jpg"
 style="width: 150px; margin-left: 9px;">
                  </span>
                  <!-- <audio controls>
                    <source [src]="message.mediaurl">
                  </audio> -->
                 
                </span>

                <!-- video -->
                <span *ngIf="message.messagetype === 'video' &&  !message.messagereplyText" (click)="getDownloadData(message.mediaid)">
                  <span *ngIf="!message.isdownload" class="addedAUdioCss">
                    <i *ngIf="!myImageIconVariable[message.mediaid]" class="pi pi-download" style="font-size: 2rem;color: #249487;cursor: pointer;    position: relative;
    bottom: 40px;
                    " (click)="getDownloadData(message)"></i>
                              <i *ngIf="myImageIconVariable[message.mediaid]" class="pi pi-spin pi-spinner" style="font-size: 2rem;color: #249487;position: relative;
    bottom: 40px;"></i>
 <img src="assets/images/video.png"
 style="    height: auto;
    width: 100px; margin-left: 9px;">
                  </span>
                 
                  <!-- <video width="320" height="240" controls>
                    <source [src]="message.mediaurl">
                  </video> -->
                </span>

                <!-- maps -->
                <span *ngIf="message.messagetype === 'location' &&  !message.messagereplyText" (click)="onSelectMaps(message)" (click)="getDownloadData(message.mediaid)">
                  <img src="assets/images/map.jpg" style="height: 200px;" *ngIf="message.messagetype === 'location'"
                    class="rel2">
                </span>
            </ng-container>
            <ng-container *ngIf="message.isdownload">
                  <!-- documents -->
                  <span [href]="message.mediaurl" *ngIf="message.messagetype == 'document' &&  !message.messagereplyText" 
                  (contextmenu)="onImageRightClick($event, message)"
                  style="border: 1px solid lightgrey; padding: 10px 15px; border-radius: 5px; background-color: rgb(255, 255, 255);    position: relative;
                  bottom: 2px;
                  height: 40px;
                  display: inline-table;
                  width: auto;">
                  <img src="assets/images/doc.png"
                    style="height: 30px; width: 30px;margin-right: 6px;">
                  <a [href]="message.mediaurl" download="{{ message.filename }}" target="_blank" style="color: #000;    position: relative;
    bottom: 9px;">{{
                    message.filename }}</a>
                </span>

                <!-- audio -->
                <span *ngIf="message.messagetype === 'audio' &&  !message.messagereplyText" (contextmenu)="onImageRightClick($event, message)" >
                  <audio controls>
                    <source [src]="message.mediaurl">
                  </audio>
                </span>

                <!-- video -->
                <span *ngIf="message.messagetype === 'video' &&  !message.messagereplyText" (contextmenu)="onImageRightClick($event, message)" >
                  <video width="320" height="240" controls>
                    <source [src]="message.mediaurl">
                  </video>
                </span>

                <!-- maps -->
                <span *ngIf="message.messagetype === 'location' &&  !message.messagereplyText" (click)="onSelectMaps(message)" >
                  <img src="assets/images/map.jpg" style="height: 200px;" *ngIf="message.messagetype === 'location'"
                    class="rel2">
                </span>
            </ng-container>


                <!-- contact -->
                <span class="repliedtext1 card" *ngIf="message.messagetype == 'contacts' && !message.messagereplyText"
                  style="margin-left: -17px;cursor: pointer;" (click)="myContactDetails(message)">
                  <a *ngIf="message.messagetype == 'contacts'">
                    <span style="display: flex;">
                      <i class="pi pi-user" style="font-size: 1.5rem;
            border: 2px solid #000;
            color: #000;
            padding: 5px;
            border-radius: 50%;"></i>
                      <a>
                        <nav style="
              padding-top: 8px;
              padding-left: 10px;">{{message.fld_Contacts_Formatted_Name}}</nav>
                      </a>
                    </span>
                    <br>
                    <a>
                      <nav>{{message.fld_Contacts_Phone}}</nav>
                    </a>
                  </a>
                </span>

                <i class="pi pi-ellipsis-h" style="margin-left: 5px; cursor: pointer;" *ngIf="!message.messagereplyText"
                  (click)="op.toggle($event); sendData(message)"></i>


                <p class="text-700 mt-0" style="color: black !important; font-size: 10px;">
                  <span (click)="callHistoryNew(message.ticketid)" class="addViewTicket"
                    *ngIf="message.ticketid != 0 || message.ticketid != '0'">
                    View Ticket
                  </span> {{ message.messageTime }}- {{message.rowid}}-
                  <span style="color: #128c7e;
    font-weight: bold;">
                    {{message.isread ? 'Read' : 'Unread'}}
                  </span>
                </p>

              </div>
            </div>

            <div class="grid grid-nogutter mb-0">
              <ng-template #notReceived style="background-color: #dcf8c6">

                <div class="col mt-1 text-right">
                  <span class="setThreeDotIcon">
                    <i class="pi pi-ellipsis-h" style="margin-right: 5px; cursor: pointer;"
                      (click)="op.toggle($event); sendData(message)"></i>

                    <!-- text -->

                    <!-- show forwarded text -->
                    <div *ngIf="message.forward == true && message.messageText" class="maintext forwardTtext card">
                      <span
                        class="sendedtext1 inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <div
                          class="forwardtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            style="height: 12px; margin: -2px 0px;">
                            <path
                              d="M13 14H11C7.54202 14 4.53953 15.9502 3.03239 18.8107C3.01093 18.5433 3 18.2729 3 18C3 12.4772 7.47715 8 13 8V3L23 11L13 19V14Z">
                            </path>
                          </svg>

                          Forwarded
                        </div>
                      </span>
                      <br>
                      <div *ngIf="message.messageText" style="padding: 3px 8px 0px 3px !important; border: none;"
                        class="inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        {{message.messageText }}
                      </div>
                      <br>
                      <div class="icon-container" style="float: right; margin-bottom: -10px; margin-right: 8px;">
                        <i class="material-icons" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus != 'error'">{{message.msgStatus}}</i>
                        <i class="material-icons newclsAddedForCusror" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus == 'error'" tooltipPosition="bottom"
                          [pTooltip]="message.rejectReason"
                          (click)="getRejectionReason(message)">{{message.msgStatus}}</i>
                      </div>
                    </div>
                    <br>
                    <div *ngIf="message.messagetype && message.messagereplyText" class="maintext">
                      <span *ngIf="message.messagetype" (contextmenu)="onImageRightClick($event, message)"
                        class="sendedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <div
                          *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true && message.replymessagetype == 'text')"
                          class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          {{ message.messagereplyText }}
                          <br>
                        </div>
                        <div
                          *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true && message.replymessagetype == 'template')"
                          class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          {{ message.messagereplyText }}
                          <br>
                        </div>
                        <div
                          *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true && message.replymessagetype == 'bot')"
                          class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          {{ message.messagereplyText }}
                          <br>
                        </div>
                        <div
                          *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true && message.replymessagetype == 'image')"
                          class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <img [src]="message.messagereplyText && (message.messagereplyText.startsWith('http') || message.messagereplyText.startsWith('https')) 
                          ? message.messagereplyText 
                          : 'assets/images/back-jp-wh.jpg'" class=" border-square shadow-4" style="width: 30px !important;
    height: 30px !important;">
                          <br>
                        </div>
                        <div
                          *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true && message.replymessagetype == 'document')"
                          class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <img src="assets/images/doc.png"  style="height: 30px; width: 30px;" class="border-square shadow-4">
                          <br>
                        </div>
                        <div
                          *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true && message.replymessagetype == 'video')"
                          class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <img src="assets/images/video.png"  style="height: 30px; width: 30px;" class="border-square shadow-4">
                          <br>
                        </div>
                        <div
                          *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true && message.replymessagetype == 'audio')"
                          class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <img src="assets/images/audio.jpg"  style="height: 30px; width: 30px;" class="border-square shadow-4">
                          <br>
                        </div>
                        <div
                          *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true && message.replymessagetype == 'location')"
                          class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <img src="assets/images/images/location-logo.jpg"  style="height: 30px; width: 30px;" class="border-square shadow-4">
                          <br>
                        </div>
                        <div
                          *ngIf="(message.messagetype && message.messagereplyText && message.isreply == true && message.replymessagetype == 'contacts')"
                          class="repliedtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <img src="assets/images/images/new-contact.png"  style="height: 30px; width: 30px;" class="border-square shadow-4">
                          <br>
                        </div>
                        <div style="padding: 8px 8px 0px 8px; margin-bottom: -20px;"
                          [innerHTML]="message.messageText | linkify" (click)="getMessageDetailsNew(message)">
                          <!-- {{message.messageText }} -->
                        </div>

                        <br>
                        <div class="icon-container" style="float: right; margin-bottom: -10px; margin-right: 8px;">
                          <i class="material-icons" [style.color]="message.msgStatusColor"
                            *ngIf="message.msgStatus != 'error'">{{message.msgStatus}}</i>
                          <i class="material-icons newclsAddedForCusror" [style.color]="message.msgStatusColor"
                            *ngIf="message.msgStatus == 'error'" tooltipPosition="bottom"
                            [pTooltip]="message.rejectReason"
                            (click)="getRejectionReason(message)">{{message.msgStatus}}</i>
                        </div>
                      </span>
                    </div>

                    <span *ngIf="message.messagetype == 'text' && !message.messagereplyText && !message.forward"
                      (contextmenu)="onImageRightClick($event, message)"
                      class="inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round"
                      style="word-break: break-word; max-width:80%; background: #dcf8c6 !important; color: black !important; padding: 8px 10px 10px 10px !important;font-size: 12px;">
                      <span [innerHTML]="message.messageText | linkify" (click)="getMessageDetailsNew(message)">

                      </span>
                      <!-- {{message.messageText }} -->
                      <br>
                      <div class="icon-container" style="float: right;">
                        <i class="material-icons" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus != 'error'">{{message.msgStatus}}</i>
                        <i class="material-icons newclsAddedForCusror" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus == 'error'" tooltipPosition="bottom"
                          [pTooltip]="message.rejectReason"
                          (click)="getRejectionReason(message)">{{message.msgStatus}}</i>
                      </div>
                    </span>

                    <!-- template -->
                    <span *ngIf="message.messagetype == 'template' && !message.messagereplyText && !message.forward"
                      (contextmenu)="onImageRightClick($event, message)"
                      class="inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round"
                      style="word-break: break-word; max-width:80%; background: #9acd32 !important; color: black !important; padding: 8px 10px 10px 10px !important;">
                      <!-- [innerHTML]="message.messageText | linkify" (click)="getMessageDetailsNew(message.messageText)"> -->
                      {{message.messageText }}
                      <br>
                      <div class="icon-container" style="float: right;">
                        <i class="material-icons" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus != 'error'">{{message.msgStatus}}</i>
                        <i class="material-icons newclsAddedForCusror" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus == 'error'" tooltipPosition="bottom"
                          [pTooltip]="message.rejectReason"
                          (click)="getRejectionReason(message)">{{message.msgStatus}}</i>
                      </div>
                    </span>

                    <!-- image -->
                    <span *ngIf="message.messagetype == 'image'"
                      class="inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round"
                      style="background: #dcf8c6 !important;    padding: 0px !important;
              display: grid !important;">
                      <ng-container *ngIf="message.forward == true"
                        class="sendedtext1 inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <div
                          class="forwardtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            style="height: 12px; margin: -2px 0px;">
                            <path
                              d="M13 14H11C7.54202 14 4.53953 15.9502 3.03239 18.8107C3.01093 18.5433 3 18.2729 3 18C3 12.4772 7.47715 8 13 8V3L23 11L13 19V14Z">
                            </path>
                          </svg>

                          Forwarded
                        </div>
                      </ng-container>
                      <a *ngIf="message.messagetype == 'image'" [href]="message.mediaurl" download="image.jpg"
                        target="_blank" (contextmenu)="onImageRightClick($event, message)">
                        <img [src]="message.mediaurl" class="w-13rem h-16rem border-square shadow-4" />
                      </a>
                      <div class="icon-container" style="float: right;display: flex;
              justify-content: end;">
                        <i class="material-icons" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus != 'error'">{{message.msgStatus}}</i>
                        <i class="material-icons newclsAddedForCusror" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus == 'error'" tooltipPosition="bottom"
                          [pTooltip]="message.rejectReason"
                          (click)="getRejectionReason(message)">{{message.msgStatus}}</i>
                      </div>
                    </span>

                    <!-- documents -->
                    <span *ngIf="message.messagetype == 'document'"
                      style="display: flex; text-align: right; display: flex; justify-content: end;">
                      <div style="border: 2px solid #dcf8c6; border-radius: 5px; padding: 3px 15px 0px 15px;
    background-color: #dcf8c6">

                        <ng-container *ngIf="message.forward == true"
                          class="sendedtext1 inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <div
                            class="forwardtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                              style="height: 12px; margin: -2px 0px;">
                              <path
                                d="M13 14H11C7.54202 14 4.53953 15.9502 3.03239 18.8107C3.01093 18.5433 3 18.2729 3 18C3 12.4772 7.47715 8 13 8V3L23 11L13 19V14Z">
                              </path>
                            </svg>

                            Forwarded
                          </div>
                        </ng-container>

                        <span [href]="message.mediaurl" *ngIf="message.messagetype == 'document'"
                          (contextmenu)="onImageRightClick($event, message)">
                          <img src="assets/images/doc.png"
                            style="height: 30px; width: 30px; margin-bottom: -9px; margin-right: 6px;">
                          <a [href]="message.mediaurl" download="{{ message.filename }}" target="_blank"
                            style="color: #000;">{{ message.filename }}</a>
                        </span>

                        <div class="icon-container" style="align-self: flex-end;">
                          <i class="material-icons" [style.color]="message.msgStatusColor"
                            *ngIf="message.msgStatus != 'error'">{{message.msgStatus}}</i>
                          <i class="material-icons newclsAddedForCusror" [style.color]="message.msgStatusColor"
                            *ngIf="message.msgStatus == 'error'" tooltipPosition="bottom"
                            [pTooltip]="message.rejectReason"
                            (click)="getRejectionReason(message)">{{message.msgStatus}}</i>
                        </div>
                      </div>
                    </span>

                    <!-- audio -->
                    <span *ngIf="message.messagetype === 'audio'"
                      class="inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round"
                      style="background: #dcf8c6 !important;padding: 8px 10px 0px 10px !important; border-radius: 28px 28px 18px 28px !important;">

                      <ng-container *ngIf="message.forward == true"
                        class="sendedtext1 inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <div
                          class="forwardtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            style="height: 12px; margin: -2px 0px;">
                            <path
                              d="M13 14H11C7.54202 14 4.53953 15.9502 3.03239 18.8107C3.01093 18.5433 3 18.2729 3 18C3 12.4772 7.47715 8 13 8V3L23 11L13 19V14Z">
                            </path>
                          </svg>

                          Forwarded
                        </div>
                      </ng-container>

                      <span *ngIf="message.messagetype === 'audio'">
                        <audio controls>
                          <!-- <source [src]="message.mediaurl"> -->
                          <source [src]="message.mediaurl" type="audio/ogg">
                          <source [src]="message.mediaurl" type="audio/mpeg">
                        </audio>
                      </span>
                      <br>
                      <div class="icon-container" style="float: right;">
                        <i class="material-icons" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus != 'error'">{{message.msgStatus}}</i>
                        <i class="material-icons newclsAddedForCusror" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus == 'error'" tooltipPosition="bottom"
                          [pTooltip]="message.rejectReason"
                          (click)="getRejectionReason(message)">{{message.msgStatus}}</i>
                      </div>
                    </span>

                    <!-- video -->
                    <span *ngIf="message.messagetype === 'video'" style="border: 1px solid red;"
                      (contextmenu)="onImageRightClick($event, message)">

                      <ng-container *ngIf="message.forward == true"
                        class="sendedtext1 inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <div
                          class="forwardtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            style="height: 12px; margin: -2px 0px;">
                            <path
                              d="M13 14H11C7.54202 14 4.53953 15.9502 3.03239 18.8107C3.01093 18.5433 3 18.2729 3 18C3 12.4772 7.47715 8 13 8V3L23 11L13 19V14Z">
                            </path>
                          </svg>

                          Forwarded
                        </div>
                      </ng-container>

                      <video width="320" height="240" controls>
                        <source [src]="message.mediaurl">
                      </video>
                      <br>
                      <div class="icon-container" style="align-self: flex-end;">
                        <i class="material-icons" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus != 'error'">{{message.msgStatus}}</i>
                        <i class="material-icons newclsAddedForCusror" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus == 'error'" tooltipPosition="bottom"
                          [pTooltip]="message.rejectReason"
                          (click)="getRejectionReason(message)">{{message.msgStatus}}</i>
                      </div>
                    </span>

                    <!-- maps -->
                    <span *ngIf="message.messagetype === 'location'" (click)="onSelectMaps(message)">
                      <ng-container *ngIf="message.forward == true"
                        class="sendedtext1 inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <div
                          class="forwardtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round"
                          style="    width: 78%;">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            style="height: 12px; margin: -2px 0px;">
                            <path
                              d="M13 14H11C7.54202 14 4.53953 15.9502 3.03239 18.8107C3.01093 18.5433 3 18.2729 3 18C3 12.4772 7.47715 8 13 8V3L23 11L13 19V14Z">
                            </path>
                          </svg>

                          Forwarded
                        </div>
                      </ng-container>
                      <img src="assets/images/map.jpg" style="height: 200px;" *ngIf="message.messagetype === 'location'"
                        class="rel2">
                      <div class="icon-container" style="align-self: flex-end;">
                        <i class="material-icons" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus != 'error'">{{message.msgStatus}}</i>
                        <i class="material-icons newclsAddedForCusror" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus == 'error'" tooltipPosition="bottom"
                          [pTooltip]="message.rejectReason"
                          (click)="getRejectionReason(message)">{{message.msgStatus}}</i>
                      </div>
                    </span>

                    <!-- contact -->
                    <span class="repliedtext1 card" *ngIf="message.messagetype == 'contacts'"
                      style="cursor: pointer;padding: 0px !important;" (click)="myContactDetails(message)">
                      <ng-container *ngIf="message.forward == true"
                        class="sendedtext1 inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                        <div
                          class="forwardtext inline-block text-left font-medium border-1 surface-border bg-primary-100 text-primary-900 p-1 white-space-normal border-round">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                            style="height: 12px; margin: -2px 0px;">
                            <path
                              d="M13 14H11C7.54202 14 4.53953 15.9502 3.03239 18.8107C3.01093 18.5433 3 18.2729 3 18C3 12.4772 7.47715 8 13 8V3L23 11L13 19V14Z">
                            </path>
                          </svg>

                          Forwarded
                        </div>
                      </ng-container>
                      <a *ngIf="message.messagetype == 'contacts'">
                        <span style="display: flex;padding: 8px;">
                          <i class="pi pi-user" style="font-size: 1.5rem;
            border: 2px solid #000;
            color: #000;
            padding: 5px;
            border-radius: 50%;"></i>
                          <a>
                            <nav style="
             padding-top: 8px;
             padding-left: 10px;">{{message.fld_Contacts_Formatted_Name}}</nav>
                          </a>
                        </span>
                        <!-- <br> -->
                        <a>
                          <nav style="padding: 5px;">{{message.fld_Contacts_Phone}}</nav>
                        </a>
                      </a>
                      <!-- <br> -->
                      <div class="icon-container" style="align-self: flex-end;margin-right: 4px;">
                        <i class="material-icons" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus != 'error'">{{message.msgStatus}}</i>
                        <i class="material-icons newclsAddedForCusror" [style.color]="message.msgStatusColor"
                          *ngIf="message.msgStatus == 'error'" tooltipPosition="bottom"
                          [pTooltip]="message.rejectReason"
                          (click)="getRejectionReason(message)">{{message.msgStatus}}</i>
                      </div>
                    </span>

                  </span>


                  <p class="text-700 mt-0" style="color: black !important; font-size: 10px;">
                    <span (click)="callHistoryNew(message.ticketid)" class="addViewTicket"
                      *ngIf="message.ticketid != 0 || message.ticketid != '0'">
                      View Ticket
                    </span> ({{agentName}} - {{message.agentID}}) - {{ message.messageTime }} - {{message.rowid}}
                  </p>
                </div>
              </ng-template>
            </div>
          </div>

          <!-- input -->
        </div>
        <!-- bottom section start -->
        <ng-container *ngIf="!sideBarMange">
          <div style="width: 30%;">
            <!-- replied height section -->
            <div
              class="reply p-3 md:p-4 lg:p-3 flex flex-column sm:flex-row align-items-center mt-auto border-top-1 surface-border gap-3"
              *ngIf="repliedMsg" style="background-color: #ebeef2; max-height: 150px !important;">
              <!-- its only to occupy space -->
              <div class="flex w-full sm:w-auto gap-3" style="visibility: hidden;">
                <p-fileUpload #fileUpload mode="basic" chooseLabel="Choose" [multiple]="true" [maxFileSize]="5000000000000"
                  (onSelect)="dealWithFiles($event)" (onClear)="dealWithFiles($event)"
                  (onRemove)="dealWithFiles($event)" [showCancelButton]="false" chooseLabel="Files"
                  class="custom-file-upload">
                  <ng-template #defaultTemplate let-files>
                    <ul *ngIf="files.length">
                      <li *ngFor="let file of files">{{file.name}}</li>
                    </ul>
                  </ng-template>
                </p-fileUpload>
                &nbsp;&nbsp;&nbsp;
              </div>
              <div class="flex w-full sm:w-auto gap-3" style="visibility: hidden;">
                <p-dropdown class="p-dropdown1" [options]="templateDropdown" [(ngModel)]="selectedTemp"
                  optionLabel="message" optionValue="message" [showClear]="true" placeholder="Templates"
                  (click)="changeTemp()"></p-dropdown>
              </div>
              <!-- its only to occupy space -->
              <div class="replayData">
                <div class="headingg">
                  <span *ngIf="repliedMsg.messagetype == 'text'">{{repliedMsg.messageText}}</span>
                  <span *ngIf="repliedMsg.messagetype == 'image'" style="display: flex;">
                    <span>
                      <img [src]="repliedMsg.mediaurl" class="w-13rem h-16rem border-square shadow-4" />
                    </span>

                    <span>
                      {{repliedMsg.filename}}
                    </span>
                  </span>

                  <span *ngIf="repliedMsg.messagetype == 'document'">
                    <img src="assets/images/doc.png"
                      style="height: 30px; width: 30px; margin-bottom: -9px; margin-right: 6px;">
                    <a [href]="repliedMsg.mediaurl" download="{{ repliedMsg.filename }}" target="_blank"
                      style="color: #000;">{{ repliedMsg.filename }}</a>
                  </span>
                  <span *ngIf="repliedMsg.messagetype == 'audio'">
                    <i class="pi pi-sliders-v"
                      style="height: 30px; margin-right: 6px; font-size: 1rem; margin-top: 20px !important;"></i>
                    <a [href]="repliedMsg.mediaurl" download="{{ repliedMsg.filename }}" target="_blank"
                      style="color: #000;">{{ repliedMsg.filename }}</a>
                  </span>
                  <span *ngIf="repliedMsg.messagetype == 'video'">{{''}}</span>
                </div>
              </div>
              <div class="close">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                  style="height: 30px; width: 30px; color: red; cursor: pointer" (click)="closeReply()">
                  <path
                    d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 10.5858L9.17157 7.75736L7.75736 9.17157L10.5858 12L7.75736 14.8284L9.17157 16.2426L12 13.4142L14.8284 16.2426L16.2426 14.8284L13.4142 12L16.2426 9.17157L14.8284 7.75736L12 10.5858Z">
                  </path>
                </svg>
              </div>
            </div>
            <div style="display: flex;justify-content: center;">
              <ng-container *ngIf="showSuggestions">
                <p-listbox [options]="templateDropdown" optionLabel="templatelabel" [style]="{'width':'45rem'}"
                  [multiple]="false" [(ngModel)]="selectedTemp1" (onChange)="changeTempValue($event)"
                  [metaKeySelection]="false" [listStyle]="{'max-height': '220px'}">
                  <ng-template let-selectedType pTemplate="item">
                    <div class="selectedType-item" style="display: flex;">
                      <span [ngStyle]="getTemplateDesignStyle(selectedType.template_type)" class="avatar">
                        {{getDropdownText(selectedType.template_type)}} <!-- Display the text based on template type -->
                      </span>
                      <div style="  white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;display: flex;width: 800px;    text-align: center;
          align-items: center;">
                        {{ selectedType.templatelabel }}</div>
                    </div>
                  </ng-template>
                </p-listbox>
              </ng-container>
            </div>
            <!-- main -->
            <div
              class="p-3 md:p-4 lg:p-3 flex flex-column sm:flex-row align-items-center mt-auto border-top-1 surface-border gap-3"
              style="background-color: #ebeef2 !important;" *ngIf="number">
              <ng-container *ngIf="openValueNew">
                <button pButton pRipple style="background-color: #128C7E; border-color: #128C7E;">{{fileName}}</button>
                <div [hidden]="showRemove">
                  <span [hidden]="showRemove" style="border-radius: 50%;
        padding: 4px 4px 2px 4px;
        background: red;
        cursor: pointer;" (click)="removeSelection()">
                    <i [hidden]="showRemove" class="pi pi-times" style="color: #fff"></i>
                  </span>
                </div>
              </ng-container>

              <ng-container>
                <audio *ngIf="newRecordValue" controls>
                  <source [src]="setMyFIleAudio" type="audio/mp3">
                </audio>
                <!-- </button> -->

                <div *ngIf="newRecordValue">
                  <span style="border-radius: 50%;
        padding: 4px 4px 2px 4px;
        background: red;
        cursor: pointer;" (click)="clearRecordedData()">
                    <i class="pi pi-times" style="color: #fff"></i>
                  </span>
                </div>
              </ng-container>

              <span style="border-radius: 50%;
  padding: 4px 4px 2px 4px;
  cursor: pointer;
  margin-right: 20px;
  height: 39px;
  width: 41px;" (click)="bottomData.toggle($event)">
                <i class="pi pi-paperclip" style="    color: #128c7ee8;
  position: relative;
  left: 4px;
  top: 3px;
  font-size: 27px;"></i>

              </span>

              <div class="flex w-full sm:w-auto gap-3">
                <p-dropdown class="p-dropdown1" [options]="templateDropdown" [(ngModel)]="selectedTemp"
                  optionLabel="templatelabel" optionValue="rowID" [showClear]="true" placeholder="Templates"
                  style="width: 60vw;" (onChange)="changeTemp()" (onClear)="onClear()">
                  <ng-template let-selectedType pTemplate="item">
                    <div class="selectedType-item" style="display: flex;">
                      <span [ngStyle]="getTemplateDesignStyle(selectedType.template_type)" class="avatar">
                        {{getDropdownText(selectedType.template_type)}} <!-- Display the text based on template type -->
                      </span>
                      <div style="  white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;display: flex;width: 800px;    text-align: center;
          align-items: center;">
                        {{ selectedType.templatelabel }}</div>
                    </div>
                  </ng-template></p-dropdown>
              </div>
              <!-- <div class="" > -->


              <input #messageInput id="messageInput" type="text" pInputText placeholder="Type a message"
                style="    max-width: 80%;" class="flex-1 w-full sm:w-auto border-round" [(ngModel)]="textContent"
                (input)="newFunction()" (keydown.enter)="sendMessage()" autocomplete="off" />
              &nbsp; &nbsp;
              <div class="flex w-full sm:w-auto gap-3">
                <button pButton pRipple icon="pi pi-send" class="w-full sm:w-auto" (click)="sendMessage()"></button>
                &nbsp;
                &nbsp;
              </div>
            </div>
          </div>

        </ng-container>
        <!-- bottom section end -->
      </div>
      <div class="card p-fluid formgrid grid overflow-y-auto" style="    padding: 10px;
      height: calc(100% - -44px);
      margin-top: 0px !important;
      width: 100%;
      margin: auto;
      border-radius: unset;
      position: relative;
      bottom: 49px;    padding-left: 0px;" *ngIf="newTicketFlag">
        <div class="col-12 md:col-12 " style="    border-radius: unset;    padding-left: 0px;">
          <div class="cardTicket dispositioncard2">

            <div class="cardTicket" style="background-color: #128c7e;
            height: 33px;
            display: flex;
            align-items: center;
            text-align: center;" *ngIf="showTicketCard">
              <ul
                style="display: flex; color:white; margin-top:0rem; margin-bottom:0rem; padding-left:0.5rem;font-size: 10px;">
                <li>Ticket Id: {{ticketNo}}</li>
                <span style="margin-left:40px;"></span>
                <li>Source: {{sourceName}}</li>
                <span style="margin-left:40px;"></span>
                <li>Campaign: {{ticketCampaignName}}</li>
                <span style="margin-left:40px;"></span>
                <li>ActionNo: {{actionNo}}</li>
                <span style="margin-left:40px;"></span>
                <li>Ticket Time: {{ticketTime}}</li>
                <span style="margin-left:40px;"></span>
                <li>Duration: {{ticketDuration}}</li>
              </ul>
              <span class="exitTicketValue" (click)="closeDetailsTicket()">Exit Ticket</span>
            </div>
            <div class="cardTicket" *ngIf="showTicketCard">
              <form [formGroup]="customForm">
                <div>
                  <div class=" dynamic-form-card" style="    margin-top: 7px;
    border-bottom: 1px dotted;">
                    <div class="p-fluid formgrid grid">
                      <ng-container *ngFor="let field of formFields">
                        <div *ngIf="field.fld_isNewRow==true"
                          style="min-inline-size: -webkit-fill-available !important;">
                        </div>
                        <div class="field col-12 md:col-12" *ngIf="field.isSeparator==true">{{field.separatorText}}
                        </div>
                        <div style="font-size:11px !important; margin-top:5px;" class="field col-12 md:col-2"
                          *ngIf="field.fld_Enable_Search==false">
                          <span style="padding-left:10px; ">{{field.name}}</span>
                        </div>
                        <div class="field col-12 md:col-2">
                          <span
                            *ngIf="field.controlType.value == 0 && field.displayInClient==true && field.isUsed==true && field.isUsed==true && field.fld_Enable_Search==false">
                            <div
                              *ngIf="field.name == 'Phone Number' || field.name == 'PhoneNo' || field.name == 'PhoneNo*' || field.name == 'Phone No'">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName" *ngIf="!isMasked"
                                required="field.required" class="p-inputtext-sm" style=" user-select: none !important;">

                              <input type="text" pInputText id="phoneInput" *ngIf="isMasked" required="field.required"
                                class="p-inputtext-sm" style=" user-select: none !important;">

                            </div>
                            <div
                              *ngIf="!(field.name == 'Phone Number' ||  field.name == 'PhoneNo' || field.name == 'PhoneNo*'  || field.name == 'Phone No')">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable">
                            </div>
                          </span>
                          <span
                            *ngIf="field.fld_Enable_Search==true && field.isUsed==true && myStudentFiledTrueFalse && !teacherFiledTrueFalse">
                            <div
                              *ngIf="field.name === 'Student Id' || field.name === 'Student Name' || field.name === 'Grade'">
                              <div style="font-size:11px !important; margin-top:5px;">
                                <span style="padding-left:10px; ">{{field.name}}</span>
                              </div>
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                style="user-select: none !important;">
                            </div>
                          </span>
                          <span
                            *ngIf="field.fld_Enable_Search==true && field.isUsed==true && teacherFiledTrueFalse && !myStudentFiledTrueFalse">
                            <div
                              *ngIf="field.name === 'Teacher Code' || field.name === 'Teacher Name' || field.name === 'Registered Mobile Number'">
                              <div style="font-size:11px !important; margin-top:5px;">
                                <span style="padding-left:10px; ">{{field.name}}</span>
                              </div>
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                style="user-select: none !important;">
                            </div>
                          </span>
                          <span
                            *ngIf="field.controlType.value == 2 && field.displayInClient==true && field.isUsed==true ">
                            <ng-container *ngIf="!hideDropDownEnableDIsable">
                              <div *ngIf="field.name === 'School Code'">
                                <p-dropdown [options]="selctedSchoolCode" [(ngModel)]="schoolCodeValue"
                                  placeholder="Select" [editable]="true" [ngModelOptions]="{standalone: true}"
                                  [filter]="true" filterBy="sclCode" (onFilter)="customFilterFunction($event)"
                                  (onClear)="ocClearData($event)" optionLabel="sclCode"
                                  (onSelect)="checkValueAfterClick($event)" (onChange)="checkValueAfterClick($event)">
                                  <ng-template pTemplate="selectedItem" let-selectedUser>
                                    <div class="selectedUser-item">
                                      <div>{{selectedUser.sclCode}}</div>
                                    </div>
                                  </ng-template></p-dropdown>
                              </div>
                              <ng-container>
                                <div *ngIf="field.name === 'School Name'">
                                  <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="schoolNameValue"
                                    [ngModelOptions]="{standalone: true}" />
                                </div>
                                <div *ngIf="field.name === 'District'">
                                  <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="districtValue"
                                    [ngModelOptions]="{standalone: true}" />
                                </div>
                                <div *ngIf="field.name === 'Block Name'">
                                  <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="blockNameValue"
                                    [ngModelOptions]="{standalone: true}" />
                                </div>
                              </ng-container>

                            </ng-container>
                            <ng-container
                              *ngIf="hideDropDownEnableDIsable && field.name != 'Designation' && field.name != 'Problem Reported' && field.name != 'Problem Category' && field.name != 'Dependent upon (State/CG)' &&  field.name != 'Bot Name'">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                style="user-select: none !important;">
                              <span (click)="returnDropDownFirst" *ngIf="field.name === 'School Code'" style="    position: relative; 
                                     float: right;
                                     bottom: 43px;
                                     left: 6px;">
                                <i class="pi pi-times-circle" style="font-size: 20px" (click)="returnDropDownFirst()"
                                  sty></i>
                              </span>
                            </ng-container>
                            <ng-container
                              *ngIf="hidePropertyValueEnable && field.name != 'Designation'   &&  field.name != 'Bot Name' && field.name != 'District' &&  field.name != 'School Name' && field.name != 'School Code' && field.name != 'Block Name'">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                style="user-select: none !important;">
                              <span (click)="returnDropDownSecond" *ngIf="field.name === 'Problem Reported'" style="    position: relative;
                                     float: right;
                                     bottom: 43px;
                                     left: 6px;">
                                <i class="pi pi-times-circle" style="font-size: 20px"
                                  (click)="returnDropDownSecond()"></i>
                              </span>
                            </ng-container>
                            <div
                              *ngIf="field.name != 'District' &&  field.name != 'School Name' && field.name != 'School Code' && field.name != 'Block Name' && field.name != 'Problem Reported' && field.name != 'Problem Category' && field.name != 'Dependent upon (State/CG)'">
                              <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                (onSelect)="getingBotNameValue($event,field)"
                                (onChange)="getingBotNameValue($event,field)" class="p-inputtext-sm"
                                [formControlName]="field.fld_FieldName" required="field.required" placeholder="select"
                                [readonly]="!field.isEditable" [filter]="true" filterBy="label">
                              </p-dropdown>
                            </div>
                            <ng-container *ngIf="!hidePropertyValueEnable">
                              <div *ngIf="field.name === 'Problem Reported'">
                                <p-dropdown [options]="getValueParakhBot" [(ngModel)]="problemReportedValue"
                                  [ngModelOptions]="{standalone: true}" optionLabel="value" optionValue="value"
                                  class="p-inputtext-sm" placeholder="Select"
                                  (onSelect)="firstProblemDropDownValue($event,field)"
                                  (onChange)="firstProblemDropDownValue($event,field)" [filter]="true" filterBy="value">
                                  <ng-template pTemplate="selectedItem" let-selectedUser>
                                    <div class="selectedUser-item" style="width: 100px !important;">
                                      <div>{{selectedUser.value}}</div>
                                    </div>
                                  </ng-template>
                                </p-dropdown>
                              </div>
                              <div *ngIf="field.name === 'Problem Category' && mainProblemDropDownValue">
                                <p-dropdown [options]="ProblemCategoryArr" optionlabel="label" optionValue="value"
                                  class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                  required="field.required" placeholder="select" [readonly]="!field.isEditable"
                                  (onSelect)="ProblemCategoryVFun($event,field)"
                                  (onChange)="ProblemCategoryVFun($event,field)" [filter]="true" filterBy="label">
                                </p-dropdown>
                              </div>
                              <div *ngIf="field.name === 'Problem Category' && !mainProblemDropDownValue">
                                <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                  class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                  required="field.required" placeholder="select" [readonly]="!field.isEditable"
                                  (onSelect)="ProblemCategoryVFun($event,field)"
                                  (onChange)="ProblemCategoryVFun($event,field)" [filter]="true" filterBy="label">
                                </p-dropdown>
                              </div>
                              <div *ngIf="field.name === 'Dependent upon (State/CG)' && mainNewVariableCheckDepenedent">
                                <p-dropdown [options]="dependentVariavbles" optionlabel="label" optionValue="value"
                                  class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                  required="field.required" placeholder="select" [readonly]="!field.isEditable"
                                  (onSelect)="DependentuponFunc($event,field)"
                                  (onChange)="DependentuponFunc($event,field)" [filter]="true" filterBy="label">
                                </p-dropdown>
                              </div>
                              <div
                                *ngIf="field.name === 'Dependent upon (State/CG)' && !mainNewVariableCheckDepenedent">
                                <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                  class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                  required="field.required" placeholder="select" [readonly]="!field.isEditable"
                                  (onSelect)="DependentuponFunc($event,field)"
                                  (onChange)="DependentuponFunc($event,field)" [filter]="true" filterBy="label">
                                </p-dropdown>
                              </div>
                            </ng-container>

                          </span>

                          <span
                            *ngIf="field.controlType.value == 3 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-checkbox binary="true" inputId="binary" [formControlName]="field.fld_FieldName"
                                required="field.required" [readonly]="!field.isEditable">
                              </p-checkbox>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 4 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-radioButton [formControlName]="field.fld_FieldName" required="field.required"
                                [readonly]="!field.isEditable">
                              </p-radioButton>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 5 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-listbox [formControlName]="field.fld_FieldName" optionLabel="name"
                                required="field.required" [readonly]="!field.isEditable"></p-listbox>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 1 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <textarea pInputTextarea [formControlName]="field.fld_FieldName" required="field.required"
                                [readonly]="!field.isEditable"></textarea>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 8 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-multiSelect [options]="cities" class="p-inputtext-sm" optionLabel="name"
                                required="field.required" [formControlName]="field.fld_FieldName" placeholder="select"
                                [readonly]="!field.isEditable"></p-multiSelect>
                            </div>
                          </span>
                        </div>
                      </ng-container>
                    </div>
                  </div>
                </div>
              </form>
              <!-- assign by && Ticket Status -->
              <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-2 md:mb-0" style="font-size: 11px;">Assigned By:<span
                    style="color:red">*</span></div>
                <div class="col-12 mb-0 md:col-3 md:mb-0">
                  <input type="text" pInputText [(ngModel)]="selectedAssignedBy" readonly="true"
                    class="p-inputtext-sm" />
                </div>

                <div class="col-12 mb-0 md:col-2 md:mb-0" style="font-size: 11px;">Ticket Status<span
                    style="color:red">*</span></div>
                <div class="col-12 mb-0 md:col-3 md:mb-0">
                  <p-dropdown class="p-inputtext-sm" id="ticketStatus" [options]="ticketStatusDropdownData"
                    [disabled]="disabledTicketFields" [filter]="true" filterBy="label" optionLabel="label"
                    optionValue="value" [(ngModel)]="selectedticketStatus" [showClear]="true" placeholder="Select"
                    (onClick)="getTicketStatus()">
                    <ng-template let-selectedType pTemplate="item">
                      <div class="selectedType-item">
                        <div>{{selectedType.label}}</div>
                      </div>
                    </ng-template>
                  </p-dropdown>
                </div>
              </div>

              <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-2 md:mb-0 " style="font-size: 11px;">Ticket Type:<span
                    style="color:red">*</span></div>

                <!-- 1st Dropdown -->
                <div class="col-12 mb-0 md:col-3 md:mb-0" *ngFor="let item of arrObj; let i = index">
                  <p-dropdown class="p-inputtext-sm" id="ticketType[i]" [options]="ticketTypeDropdownData[i]"
                    [disabled]="disabledTicketFields" appendTo="body" [filter]="true" filterBy="label"
                    optionLabel="label" optionValue="value" [(ngModel)]="selectedTicketType[i] " [showClear]="true"
                    placeholder="Select" (onChange)="ticketTypeDropdown(i)">
                    <ng-template let-selectedType pTemplate="item">
                      <div class="selectedType-item">
                        <div>{{selectedType.label}}</div>
                      </div>
                    </ng-template>
                  </p-dropdown>
                </div>

              </div>


              <!-- tree -->
              <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-12 md:mb-0" style="font-size: 11px;">Tree : {{tree}}</div>

              </div>

              <!-- voice file -->
              <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;"
                *ngIf="voicefile">
                <div class="col-12 mb-0 md:col-2 md:mb-0" style="font-size: 11px;">Voice File:</div>
                <div class="col-12 mb-0 md:col-6 md:mb-0">
                  <audio controls>
                    <source [src]="voicefile" type="audio/wav">
                  </audio>
                </div>
              </div>
            </div>

            <div class="cardTicket" *ngIf="showDynaTicketCard">
              <form [formGroup]="ticketForm">
                <div>
                  <div class="dynamic-form-card">
                    <div class="p-fluid formgrid grid" style="padding-left: 10px !important; margin-top:10px;">
                      <ng-container *ngFor="let field of ticketFields">
                        <div *ngIf="field.fld_isNewRow==true"
                          style="min-inline-size: -webkit-fill-available !important;">
                        </div>
                        <div class="field col-12 md:col-12" *ngIf="field.isSeparator==true">
                          <div class="flex flex-wrap">
                            <span>{{field.separatorText}}</span>
                            <span class="remaining-space"></span>
                          </div>
                        </div>
                        <div style="font-size:11px !important; margin-top:5px;" class="field col-12 md:col-2">
                          <span>{{field.name}}</span>
                        </div>
                        <div class="field col-12 md:col-2">
                          <span
                            *ngIf="field.controlType.value == 0 && field.displayInClient==true && field.isUsed==true && field.isUsed==true">
                            <div *ngIf="field.name === 'Phone Number'">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm">
                            </div>

                            <div *ngIf="!(field.name == 'Phone Number')">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm">
                            </div>

                          </span>

                          <span
                            *ngIf="field.controlType.value == 3 && field.displayInClient==true && field.isUsed==true">
                            <div>

                              <p-checkbox binary="true" inputId="binary" [formControlName]="field.fld_FieldName"
                                required="field.required">
                              </p-checkbox>
                            </div>

                          </span>

                          <span
                            *ngIf="field.controlType.value == 4 && field.displayInClient==true && field.isUsed==true">
                            <div *ngFor="let radioOption of field.selectItems">
                              <p-radioButton binary="true" inputId="binary" [value]="radioOption.value"
                                [formControlName]="field.fld_FieldName"></p-radioButton>
                              <label class="ml-2">{{ radioOption.label }}</label>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 7 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-calendar [formControlName]="field.fld_FieldName" optionLabel="name"
                                required="field.required"></p-calendar>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 1 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <textarea pInputTextarea [formControlName]="field.fld_FieldName"
                                required="field.required"></textarea>
                            </div>
                          </span>
                          <span
                            *ngIf="field.controlType.value == 5 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-multiSelect [options]="field.selectItems" class="p-inputtext-sm" optionLabel="label"
                                optionValue="value" [formControlName]="field.fld_FieldName"
                                defaultLabel="Select Value"></p-multiSelect>
                            </div>

                          </span>
                          <span
                            *ngIf="field.controlType.value == 8 && field.displayInClient == true && field.isUsed == true">
                            <div *ngFor="let category of field.selectItems" class="field-checkbox">
                              <p-checkbox name="group" [value]="category.value" [(ngModel)]="abc"
                                [formControlName]="field.fld_FieldName" [inputId]="category.key"></p-checkbox>
                              <label [for]="category.key">{{ category.label }}</label>

                            </div>
                            <!-- {{category.value |json}} -->
                          </span>


                          <span
                            *ngIf="field.controlType.value == 2 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                                placeholder="select" [filter]="true" filterBy="label">
                              </p-dropdown>
                            </div>
                          </span>
                        </div>

                      </ng-container>
                    </div>
                  </div>
                </div>
              </form>

            </div>

            <div class="cardTicket" *ngIf="showTicketCard">
              <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-2 md:mb-0" style="font-size: 11px;">Agent Remarks:</div>
                <div class="col-12 mb-0 md:col-6 md:mb-0">
                  <textarea rows="2" cols="40" id="agentRemarks" name="agentRemarks" pInputTextarea class="p-inputtext"
                    [disabled]="disabledTicketFields" placeholder=" " [(ngModel)]="agentRemarks"></textarea>
                </div>
              </div>
            </div>


            <div class="cardTicket" *ngIf="showTicketCard">
              <div class="grid forms-grid flex-row p-fluid"
                style="padding-left: 10px !important; margin-top:10px;padding-bottom: 11px;">

                <!-- <div class="col-12 mb-0 md:col-1 md:mb-0">
                  <div>Ticket Id</div>
                </div>
                <div class="col-12 mb-0 md:col-2 md:mb-0">
                  <div><input class="p-inputtext-sm" type="text" pInputText [(ngModel)]="ticketNo" /></div>
                </div> -->

                <div class="col-12 mb-0 md:col-3 md:mb-0" *ngIf="getUdatedDialogData">
                  <button (click)="callHistory()" pButton pRipple type="button" label="Ticket History" style="background: #128c7e;    white-space: pre;
    width: 100%;">
                  </button>
                </div>
                <div class="col-12 mb-0 md:col-2 md:mb-0">
                  <button pButton pRipple type="submit" style="background: #128c7e;" label="Save"
                    (click)="saveDynamicLeadCustField()" *ngIf="showSaveButton">
                  </button>
                  <!-- <button pButton pRipple type="submit" style="background: #128c7e;" label="Save" (click)="saveTicketData()"
                            *ngIf="showSaveButton">
                        </button> -->

                  <button pButton (click)="updateTiecket()" pButton pRipple style="background: #128c7e;" type="Update"
                    label="Update" *ngIf="showUpdateButton">
                  </button>
                </div>
              </div>
            </div>
          </div>



        </div>
      </div>

      <div class="p-fluid formgrid grid overflow-y-auto card" style="padding: 10px;
      width: 100%;
      margin: auto;
      height: calc(100% - -48px);
      margin-top: 0px !important;
      position: relative;
      bottom: 48px;
      border-radius: unset;" *ngIf="ticketHistoryValueOpen">
        <div class="col-12 md:col-12">
          <!-- <i class="pi pi-times-circle" (click)="closeDetailsTicketNew()" style="font-size: 2rem;z-index: 4;
  float: right;
  position: relative;cursor: pointer;
  left: 18px;
  bottom: 7px;"></i> -->
          <p-table #dt1 [value]="ticketRecordsValueComman" styleClass="p-datatable-gridlines" selectionMode="single"
            scrollHeight="350px" [(selection)]="selecteddata" dataKey="code" [metaKeySelection]="true"
            responsiveLayout="scroll" [paginator]="true" [rowsPerPageOptions]="[10,15,30,50,75,  { showAll: 'All' }]"
            [rows]="10" [showCurrentPageReport]="true" responsiveLayout="scroll"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            [globalFilterFields]="['ticketID', 'campName']">
            <ng-template pTemplate="caption">
              <div class="flex">
                <p-button label="Clear" icon="pi pi-filter-slash" (click)="clear(dt1)"></p-button>
                <span class="p-input-icon-left ml-auto" style="width: 20%;">
                  <i class="pi pi-search"></i>
                  <input pInputText type="text" (input)="dt1.filterGlobal($any($event.target).value, 'contains')"
                    placeholder="Search keyword" />
                </span>
                <p-button label="Exit Ticket" style="margin-left: 4px;" (click)="closeDetailsTicketNew()"></p-button>

              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th>
                  Ticket Id
                </th>
                <th>
                  Source
                </th>
                <th>
                  Campaign

                </th>
                <th>
                  ActionNo
                </th>
                <th>
                  Ticket Time
                </th>
                <th>
                  Duration
                </th>
                <th>
                  Ticket Start Time
                </th>
                <th>
                  Ticket End Time
                </th>
                <th>
                  Ticket Type
                </th>
                <th>
                  Ticket Status
                </th>
                <th>
                  Assigned By
                </th>
                <th>
                  UpdateBy
                </th>
                <!-- <th>
                  Tree
                </th> -->
                <th>
                  Agent Remarks
                </th>
                <th>
                  Update Ticket
                </th>
                <th>
                  Details
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-Dataaa>
              <tr [pSelectableRow]="selectedData" (click)="onRowClick(Dataaa)">
                <td>
                  <span class="p-column-title">CallID </span>
                  {{Dataaa.ticketID}}
                </td>
                <td style="font-weight:600; ">
                  <span class="p-column-title">PhoneNo.</span>
                  <span class="image-text">{{Dataaa.sourceName}}</span>
                </td>

                <td style="font-weight:600; ">
                  <span class="p-column-title">Agnet No.</span>
                  <span class="image-text">{{Dataaa.campName}}</span>
                </td>
                <td style="font-weight:600; ">
                  <span class="p-column-title">Start Time</span>
                  <span class="image-text">{{Dataaa.action_No}}</span>
                </td>
                <td style="font-weight:600; ">
                  <span class="p-column-title">End Time</span>
                  <span class="image-text">{{Dataaa.ticket_Time}}</span>
                </td>
                <td style="font-weight:600; ">
                  <span class="p-column-title">Talk Time</span>
                  <span class="image-text">{{Dataaa.ticketTime}}</span>
                </td>


                <td style="font-weight:600; ">
                  <span class="p-column-title">Agent Ansd</span>
                  <span class="image-text">{{Dataaa.start_Time}}</span>
                </td>
                <td style="font-weight:600; ">
                  <span class="p-column-title">Customer Ansd</span>
                  <span>{{Dataaa.ticketElapsedTime}}</span>
                </td>
                <td style="font-weight:600; ">
                  <span class="p-column-title">Customer Ansd</span>
                  <span>{{Dataaa.ticket_type_name}}</span>
                </td>
                <td style="font-weight:600; ">
                  <span class="p-column-title">Customer Ansd</span>
                  <span>{{Dataaa.ticket_StatusName}}</span>
                </td>
                <td style="font-weight:600; ">
                  <span class="p-column-title">Customer Ansd</span>
                  <span>{{Dataaa.assignedByID}}</span>
                </td>
                <td style="font-weight:600; ">
                  <span class="p-column-title">Customer Ansd</span>
                  <span>{{Dataaa.updatedByID}}</span>
                </td>
                <td style="font-weight:600; ">
                  <span class="p-column-title">Customer Ansd</span>
                  <span>{{Dataaa.remarks}}</span>
                </td>
                <td style="font-weight:600; ">

                  <span class="" (click)="ticketOpen(Dataaa)">
                    <i class="pi pi-pencil"></i>
                  </span>
                </td>
                <td style="font-weight:600; ">
                  <span class="" (click)="callHistoryOne(Dataaa)">
                    <i class="pi pi-eye"></i>
                  </span>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="16">No Record found.</td>
              </tr>
            </ng-template>
            <ng-template pTemplate="paginatorleft">
              <div class="grid-child" style="margin-left: 5px">
                <button type="button" class="change" style="display: none;" label="Export" pButton pRipple
                  icon="pi pi-file-excel" [style]="{'background':'#69a74e ','height':'38px', 'font-size': '11px'}"
                  class="p-button-success mr-2 sceenwidthsize" pTooltip="XLS" tooltipPosition="bottom"></button>
              </div>
            </ng-template>
            <ng-template pTemplate="paginatorright">
              <div class="grid-child" style="margin-left: 5px">
                <button type="button" class="change" label="Export" pButton pRipple icon="pi pi-file-excel"
                  [style]="{'background':' green !important','height':'30px','margin-left':'10px'}"
                  (click)="exportExcel()" class="p-button-success mr-2 sceenwidthsize" pTooltip="XLS"
                  tooltipPosition="bottom"></button>
              </div>
            </ng-template>
          </p-table>
        </div>
      </div>
      <!-- ticket histroy table end -->

      <!-- bottom section start -->
      <ng-container *ngIf="sideBarMange">
        <!-- replied height section -->
        <div
          class="reply p-3 md:p-4 lg:p-3 flex flex-column sm:flex-row align-items-center mt-auto border-top-1 surface-border gap-3"
          *ngIf="repliedMsg"
          style="background-color: #ebeef2; max-height: 150px !important;padding: 0px !important;padding-left: 2rem !important;">
          <!-- its only to occupy space -->
          <div class="replayData">
            <div class="headingg">
              <span *ngIf="repliedMsg.messagetype == 'text'">{{repliedMsg.messageText}}</span>
              <span *ngIf="repliedMsg.messagetype == 'image'" style="display: flex;">
                <span>
                  <img [src]="repliedMsg.mediaurl" class=" border-square shadow-4" style="height: 40px  !important;width: 40px !important;" />
                </span>

                <span>
                  {{repliedMsg.filename}}
                </span>
              </span>

              <span *ngIf="repliedMsg.messagetype == 'document'">
                <img src="assets/images/doc.png"
                  style="height: 30px; width: 30px; margin-bottom: -9px; margin-right: 6px;">
                <a [href]="repliedMsg.mediaurl" download="{{ repliedMsg.filename }}" target="_blank"
                  style="color: #000;">{{ repliedMsg.filename }}</a>
              </span>
              <span *ngIf="repliedMsg.messagetype == 'audio'">
                <i class="pi pi-sliders-v"
                  style="height: 30px; margin-right: 6px; font-size: 1rem; margin-top: 20px !important;"></i>
                <a [href]="repliedMsg.mediaurl" download="{{ repliedMsg.filename }}" target="_blank"
                  style="color: #000;">{{ repliedMsg.filename }}</a>
              </span>
              <span *ngIf="repliedMsg.messagetype == 'video'">{{''}}</span>
            </div>
          </div>
          <div class="close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
              style="height: 30px; width: 30px; color: red; cursor: pointer" (click)="closeReply()">
              <path
                d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 10.5858L9.17157 7.75736L7.75736 9.17157L10.5858 12L7.75736 14.8284L9.17157 16.2426L12 13.4142L14.8284 16.2426L16.2426 14.8284L13.4142 12L16.2426 9.17157L14.8284 7.75736L12 10.5858Z">
              </path>
            </svg>
          </div>
        </div>
        <div style="display: flex;justify-content: center;">
          <ng-container *ngIf="showSuggestions">
            <p-listbox [options]="templateDropdown" optionLabel="templatelabel" [style]="{'width':'45rem'}"
              [multiple]="false" [(ngModel)]="selectedTemp1" (onChange)="changeTempValue($event)"
              [metaKeySelection]="false" [listStyle]="{'max-height': '220px'}">
              <ng-template let-selectedType pTemplate="item">
                <div class="selectedType-item" style="display: flex;">
                  <span [ngStyle]="getTemplateDesignStyle(selectedType.template_type)" class="avatar">
                    {{getDropdownText(selectedType.template_type)}} <!-- Display the text based on template type -->
                  </span>
                  <div style="  white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;display: flex;width: 800px;    text-align: center;
          align-items: center;">
                    {{ selectedType.templatelabel }}</div>
                </div>
              </ng-template>
            </p-listbox>
          </ng-container>
        </div>
        <!-- main -->
        <div
          class="p-3 md:p-4 lg:p-3  align-items-center mt-auto border-top-1 surface-border gap-3"
          style="background-color: #ebeef2 !important;display: flex  !important;" *ngIf="number">
          <ng-container *ngIf="openValueNew">
            <button pButton pRipple style="background-color: #128C7E; border-color: #128C7E;">{{fileName}}</button>
            <div [hidden]="showRemove">
              <span [hidden]="showRemove" style="border-radius: 50%;
        padding: 4px 4px 2px 4px;
        background: red;
        cursor: pointer;" (click)="removeSelection()">
                <i [hidden]="showRemove" class="pi pi-times" style="color: #fff"></i>
              </span>
            </div>
          </ng-container>

          <ng-container>
            <!-- <button pButton pRipple style="background-color: #128C7E; border-color: #128C7E;"> -->
            <audio *ngIf="newRecordValue" controls>
              <source [src]="setMyFIleAudio" type="audio/mp3">
            </audio>
            <!-- </button> -->

            <div *ngIf="newRecordValue">
              <span style="border-radius: 50%;
        padding: 4px 4px 2px 4px;
        background: red;
        cursor: pointer;" (click)="clearRecordedData()">
                <i class="pi pi-times" style="color: #fff"></i>
              </span>
            </div>
          </ng-container>

          <span  style="border-radius: 50%;
  padding: 4px 4px 2px 4px;
  cursor: pointer;
  margin-right: 20px;
  height: 39px;
  width: 41px;" (click)="bottomData.toggle($event)">
            <i class="pi pi-paperclip" style="    color: #128c7ee8;
  position: relative;
  left: 4px;
  top: 3px;
  font-size: 27px;"></i>

          </span>

          <div class=" w-full sm:w-auto gap-3 addMobileCls">
            <p-dropdown class="p-dropdown1" [options]="templateDropdown" [(ngModel)]="selectedTemp" [disabled]="myInputFieldDisabled"
              optionLabel="templatelabel" optionValue="rowID" [showClear]="true" placeholder="Templates"
              style="width: 60vw;" (onChange)="changeTemp()" (onClear)="onClear()">
              <ng-template let-selectedType pTemplate="item">
                <div class="selectedType-item" style="display: flex;">
                  <span [ngStyle]="getTemplateDesignStyle(selectedType.template_type)" class="avatar">
                    {{getDropdownText(selectedType.template_type)}} <!-- Display the text based on template type -->
                  </span>
                  <div style="  white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;display: flex;width: 800px;    text-align: center;
          align-items: center;">
                    {{ selectedType.templatelabel }}</div>
                </div>
              </ng-template>
            </p-dropdown>
          </div>
          <!-- <div class="" > -->


          <input #messageInput id="messageInput" type="text" pInputText placeholder="Type a message"
            style="min-width: 65%;max-width: 80%;" class="flex-1 w-full sm:w-auto border-round" [(ngModel)]="textContent" [disabled]="myInputFieldDisabled"
            (input)="newFunction()" (keydown.enter)="sendMessage()" autocomplete="off" />
          &nbsp; &nbsp;
          <div class="flex w-full sm:w-auto gap-3">
            <button pButton pRipple icon="pi pi-send" class="w-full sm:w-auto" (click)="sendMessage()"></button> &nbsp;
            <!-- <button *ngIf="showdata" pButton pRipple icon="pi pi-send" class="w-full sm:w-auto" (click)="sendMessage()"></button> &nbsp; -->
            &nbsp;
          </div>
          <!-- <div class="flex w-full sm:w-auto gap-3">
    <button pButton pRipple icon="pi pi-microphone" class="w-full sm:w-auto" style="height: 41px;"
      *ngIf="!isRecording && !blobUrl" (click)="startRecording()">

      <i class="material-symbols-outlined">
        mic
      </i>
    </button> &nbsp;
    <div *ngIf="isRecording && !blobUrl" style="    position: relative;
    bottom: 17px;
    left: 36px;"> {{recordedTime}} </div>

    <button pButton pRipple icon="pi pi-stop-circle " class="w-full sm:w-auto" *ngIf="isRecording && !blobUrl"
      (click)="stopRecording()"></button> &nbsp;
    &nbsp;
  </div> -->
        </div>

      </ng-container>
      <!-- bottom section end -->

    </div>
  </div>
</div>



<!-- dialogs -->
<p-dialog position="top" [(visible)]="newNumberDialog" [style]="{'width': '45vw', 'height': 'auto'}"
  header="Message Forwarding" [modal]="true" [draggable]="false" [resizable]="false">
  <div class="grid forms-grid flex-row p-fluid mt-2" *ngIf="forwardContacts">
    <div class="col-12 mb-0 md:col-4 md:mb-0">Contact List:</div>
    <div class="col-12 mb-0 md:col-8 md:mb-0">
      <p-dropdown [options]="forwardContacts" [(ngModel)]="newNo" placeholder="Select number" [editable]="true"
        (onChange)="onChangeDataForward($event)" [maxLength]="12" optionLabel="phoneNumber" appendTo="body" [filter]="true"></p-dropdown>

    </div>
  </div>



  <div class="grid forms-grid flex-row p-fluid">
    <div class="col-12 mb-0 md:col-8 md:mb-0"></div>
    <div class="col-12 mb-0 md:col-4 md:mb-0">
      <button pButton label="Forward" icon="pi pi-send" (click)="sendForward()" style="background: #128C7E !important;
      border: #128C7E !important;"></button>
    </div>
  </div>

</p-dialog>


<p-dialog position="top" [(visible)]="updatednewNumberDialog" [style]="{'width': 'auto', 'height': 'auto'}"
  header="New Number" [modal]="true" [draggable]="false" [resizable]="false">

  <div class="grid forms-grid flex-row p-fluid mt-2">
    <div class="col-12 mb-0 md:col-4 md:mb-0">Enter your Number<span style="color:red">*</span> :</div>
    <div class="col-12 mb-0 md:col-8 md:mb-0">
      <input type="text" pInputText [(ngModel)]="newNo" class="p-inputtext-sm" maxlength="12" [maxlength]="12"
        [maxLength]="10" />
    </div>

    <div class="flex col-12 mb-0 md:col-12 md:mb-0" style="padding: 0;">
      <div class="col-12 mb-0 md:col-4 md:mb-0 addMobileCls"></div>
      <div class="col-12 mb-0 md:col-8" style="margin-top: -29px; font-size: 10px;">Please enter your number without
        country code</div>
    </div>
  </div>

  <div class="grid forms-grid flex-row p-fluid" *ngIf="this.selectTemplates.length > 1">
    <div class="col-12 mb-0 md:col-4 md:mb-0">Select Template<span style="color:red">*</span> :</div>
    <div class="col-12 mb-0 md:col-8 md:mb-0">
      <p-dropdown [options]="selectTemplates" optionLabel="tempName" optionValue="tempName" class="p-inputtext-sm"
        [(ngModel)]="selectedTemplateValue" placeholder="Select Template" [filter]="true" filterBy="tempName"
        appendTo="body">
        <ng-template let-selectedType pTemplate="item">
          <div class="selectedType-item">
            <div>{{ selectedType.tempName }}</div>
          </div>
        </ng-template>
      </p-dropdown>
    </div>
  </div>

  <div class="grid forms-grid flex-row p-fluid">
    <div class="col-12 mb-0 md:col-8 md:mb-0"></div>
    <div class="col-12 mb-0 md:col-4 md:mb-0">
      <button pButton label="Send Message" icon="pi pi-send" (click)="sendNewMsg()" style="background: #128C7E !important;
      border: #128C7E !important;"></button>
    </div>
  </div>

</p-dialog>


<p-overlayPanel #op>
  <ng-template pTemplate="content">

    <div class="align-items-center replySection" (click)="replyMsg(mySendDat);">
      Reply
    </div>
    <br>
    <div class="align-items-center replySection" (click)="forwardMsg(mySendDat)">
      Forward
    </div>
    <br>
    <div class="align-items-center replySection" (click)="followUpMessage(mySendDat)">
      Follow-up
    </div>
    <br>
    <div class="align-items-center replySection" [hidden]="!ticketEnable" (click)="ticketOpen(mySendDat)">
      Ticket
    </div>
  </ng-template>
</p-overlayPanel>
<p-overlayPanel #opTop>
  <ng-template pTemplate="content">
    <div class="align-items-center replySection addMobileCls1" style="padding-bottom: 6px !important;"  *ngIf="showFaqDetails" (click)="getFaqDetails()">
      FAQ's
    </div>
    <div class="align-items-center replySection addMobileCls1" style="padding-bottom: 6px !important;" *ngIf="contactSharing" (click)="sendBusinessContact()">
      Send Contact
    </div>
    <div class="align-items-center replySection addMobileCls1" style="padding-bottom: 6px !important;" *ngIf="smsApi" (click)="sendInviteApi($event)">
      Send Invite
    </div>
   <span [hidden]="!ticketEnable" style="padding-bottom: 6px  !important;">
    <div class="align-items-center replySection" [hidden]="!ticketEnable" (click)="newTicketOpen()">
      New Ticket
    </div>
    <div class="align-items-center replySection" [hidden]="!ticketEnable" (click)="getAllTickets()">
      View Ticket
    </div>
   </span>
    <div class="align-items-center replySection" *ngIf="sessionStatus" (click)="sessionClose(number)">
      End
    </div>
  </ng-template>
</p-overlayPanel>


<!-- conatcatsdetails -->

<p-dialog header="Contact Details" [modal]="true" [(visible)]="visible" [style]="{ width: '30rem' }"
  class="newDialogCls" [breakpoints]="{ '1199px': '40vw', '575px': '90vw' }">
  <ng-container *ngFor="let item of mainContactDetailsArr">
    <p class="mb-1"><strong>Name:</strong> {{ item?.name?.formatted_name }}</p>
    <p class="mb-1"><strong>D.O.B:</strong> {{ item?.birthday }}</p>

    <ng-container *ngIf="item.phones">
      <p class="mb-1"><strong>Phone Numbers:</strong></p>
      <ul class="unorderListCls">
        <li *ngFor="let phone of item.phones">
          {{ phone?.type }}:
          <span (click)="phoneNumberGetting(phone)">  
            {{ phone?.phone }} <span class="whastappIcon" *ngIf="phone.phone &&  phone.phone != ''" style="margin-left: 2px;    width: 21px;
            height: 21px;
            display: inline-block;">
              <i class="material-icons" style="    color: #fff;
  position: relative;
  left: 5px;
  top: 1px;
  font-size: 11px !important;">add_ic_call</i>
            </span>
          </span>
        </li>
      </ul>
    </ng-container>

    <ng-container *ngIf="item.emails && item.email != null">
      <p class="mb-1"><strong>Emails:</strong></p>
      <ul class="unorderListCls">
        <li *ngFor="let email of item.emails">
          {{ email?.type }}:
          <span>
            {{ email?.email }} <span (click)="gettingEmailAddress(email)">
             <span class="whastappIcon" style="margin-left: 2px;    width: 21px;
             height: 21px;
             display: inline-block;" *ngIf="enableEmail">
                <i class="material-icons" style="color: #fff;position: relative;left: 5px;top: 1px;font-size: 11px !important;">mail</i>
              </span>
            </span>
          </span>
        </li>
      </ul>
    </ng-container>
    <ng-container *ngIf="item.addresses && item.addresses[0] && item.addresses[0].street != null">
      <p class="mb-1"><strong>Addresses:</strong></p>
      <ul class="unorderListCls">
        <li *ngFor="let address of item.addresses">
          {{ address?.type }}: {{ address?.email }} {{address?.street}} {{address?.city}} {{address?.state}}
          {{address?.country_code}} {{address?.country}} {{address?.zip}}
        </li>
      </ul>
    </ng-container>
    <ng-container *ngIf="item.urls && item.urls[0] && item.urls[0].url != null">
      <p class="mb-1"><strong>URL's:</strong></p>
      <ul class="unorderListCls">
        <li *ngFor="let url of item.urls">
          {{ url?.type }}:
          <span>
            <a [href]="url?.url" target="_blank" rel="noopener noreferrer" style="color: #fff;">
              {{ url?.url }}
            </a>
          </span>
        </li>
      </ul>
    </ng-container>
  </ng-container>
</p-dialog>


<!-- location sending -->
<!-- dialogs -->
<p-dialog position="top" [(visible)]="locationVis" [style]="{'width': '45vw', 'height': 'auto'}" header="Location"
  [modal]="true" [draggable]="false" [resizable]="false">
  <div class="grid forms-grid flex-row p-fluid mt-2">
    <div class="col-12 mb-0 md:col-4 md:mb-0">Contact Location:</div>
    <div class="col-12 mb-0 md:col-8 md:mb-0">
      <p-dropdown [options]="myLOcationDataNew" [(ngModel)]="locationV" placeholder="Select number" [editable]="false"
        optionLabel="first_name" appendTo="body" [filter]="true" (onSelect)="checkValueNew($event)"
        (onChange)="checkValueNew($event)">
        <ng-template let-option pTemplate="item">
          <div class="flex align-items-center">
            <span>{{ option.first_name }} ({{ option.phoneNo }})</span>
          </div>
        </ng-template>
      </p-dropdown>
      <!-- <p>
        Latitude : {{fld_Location_Latitude}}
      </p>
      <p>
        Longitude : {{fld_Location_Longitude}}
      </p> -->
    </div>
  </div>



  <div class="grid forms-grid flex-row p-fluid">
    <div class="col-12 mb-0 md:col-8 md:mb-0"></div>
    <div class="col-12 mb-0 md:col-4 md:mb-0">
      <button pButton label="Send Location" icon="pi pi-send" (click)="sendMessage()" style="background: #128C7E !important;
      border: #128C7E !important;"></button>
    </div>
  </div>

</p-dialog>

<!-- <div class="card flex justify-content-center">
  <p-button (click)="bottomData.toggle($event)" icon="pi pi-share-alt" label="Share" /> -->
<p-overlayPanel #bottomData>
  <div class="flex flex-column gap-3 " style="width: 2rem  !important;">
    <div>
      <ul class="list-none p-0 m-0 flex flex-column gap-3">
        <li class="flex align-items-center gap-2" style="margin-bottom: 5px;cursor: pointer;" pTooltip="Location"
          tooltipPosition="right" (click)="getLocation();">
          <!-- <i class="pi pi-map-marker"></i> -->
           <img src="assets/images/images/location-logo.jpg" alt="" style="    height: 25px;
    width: 25px;">
        </li>
        <li class="flex align-items-center gap-2" style="margin-top: 3px;cursor: pointer;" pTooltip="Contacts"
          tooltipPosition="right" (click)="sendContactDEatisl()">
          <!-- <i class="pi pi-user"></i> -->
          <img src="assets/images/images/new-contact.png" alt="" style="    height: 18px;
          width: 18px;
          margin-left: 3px;">
        </li>
        <li class="flex align-items-center gap-2" style="margin-top: 8px;cursor: pointer;" pTooltip="Upload"
          tooltipPosition="right">
          <label style="display: none;">
            <input hidden id="upload_file" type="file" #file (change)="onChange(file)">
          </label>
          <input hidden readonly="true" type="text" id="file" (click)="trigger()">
          <!-- <i class="pi pi-upload" (click)="trigger()"></i> -->
           <img  src="assets/images/upload.png" alt="" (click)="trigger()" style="    height: 16px;
           width: 16px;
           margin-left: 4px;">
        </li>
      </ul>
    </div>
  </div>
</p-overlayPanel>
<!-- </div> -->
<!-- contact sharing -->
<!-- dialogs -->
<p-dialog position="top" [(visible)]="sendContactSharing" [style]="{'width': '45vw', 'height': 'auto'}"
  header="Contact Sharing" [modal]="true" [draggable]="false" [resizable]="false">
  <div class="grid forms-grid flex-row p-fluid mt-2">
    <div class="col-12 mb-0 md:col-4 md:mb-0">Contact List:</div>
    <div class="col-12 mb-0 md:col-8 md:mb-0">
      <p-dropdown [options]="matchedContacts" [(ngModel)]="newNoSend" placeholder="Select number" [editable]="false"
        (onChange)="onChangeData($event)"  optionLabel="phone" appendTo="body" [filter]="true">
        <ng-template let-option pTemplate="item">
          <div class="flex align-items-center">
            <span>{{ option.name }} ({{ option.phone }})</span>
          </div>
        </ng-template></p-dropdown>
      <!-- <p-dropdown [options]="forwardContacts" [(ngModel)]="newNoSend" placeholder="Select number" [editable]="true"
        (onChange)="onChangeData($event)" optionLabel="phoneNumber" appendTo="body" [filter]="true"></p-dropdown> -->

    </div>
  </div>



  <div class="grid forms-grid flex-row p-fluid">
    <div class="col-12 mb-0 md:col-8 md:mb-0"></div>
    <div class="col-12 mb-0 md:col-4 md:mb-0">
      <button pButton label="Send Contact" icon="pi pi-send" (click)="sendMessage()" style="background: #128C7E !important;
      border: #128C7E !important;"></button>
    </div>
  </div>

</p-dialog>

<!-- follow ups details dialog -->
<p-dialog position="top" [(visible)]="mainFollowPopup" [style]="{'width': '45vw', 'height': 'auto'}" header="Follow-up"
  [modal]="true" [draggable]="false" [resizable]="false">
  <div class="grid forms-grid flex-row p-fluid mt-2">
    <div class="col-12 mb-0 md:col-4 md:mb-0">Follow-up Message:</div>
    <div class="col-12 mb-0 md:col-8 md:mb-0">
      <div class="mr-1">
        <p-calendar placeholder="Select Followup" [(ngModel)]="rangeDates" selectionMode="range" [readonlyInput]="true"
          (click)="selectDates()" appendTo="body"></p-calendar>
        <!-- <span class="new">
        </span> -->
      </div>
    </div>
  </div>
  <div class="grid forms-grid flex-row p-fluid">
    <div class="col-12 mb-0 md:col-8 md:mb-0"></div>
    <div class="col-12 mb-0 md:col-4 md:mb-0">
      <button pButton label="Send Follow-up" icon="pi pi-send" (click)="selectFloowup()" style="      background: #128C7E !important;
    border: #128C7E !important;  width: 100%;
    white-space: pre;"></button>
    </div>
  </div>

</p-dialog>

<!-- email code dynamic -->
<p-dialog header="Compose Email" [modal]="true" [(visible)]="emailPopUpTrueFalse" [style]="{ width: '85rem' }"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }">
  <div class="surface-section grid mt-2 grid-nogutter formgrid p-4 gap-3 md:surface-border md:border-1 border-round"
    style="    max-height: 100%;
    padding: 10px !important;
    border-color: cadetblue;
    height: auto;
">
    <div class="col-6 field flex flex-wrap">
      <span for="to" class="text-900 font-semibold col-12 mb-0 md:col-2 md:mb-0"
        style="padding-top: 10px;">Account</span>
      <span class="p-input-icon-right col-12 mb-0 md:col-10 md:mb-0">
        <p-dropdown [options]="accountDropdown" [(ngModel)]="newMail.from" optionLabel="label" optionValue="value"
          class="p-inputtext-sm newAddedCls newCssAdded" optionValue="value" (onSelect)="chanegAc($event)"></p-dropdown>

      </span>
    </div>
    <div class="col-6 field flex flex-wrap">
      <span for="template" class="text-900 font-semibold col-12 mb-0 md:col-2 md:mb-0"
        style="padding-top: 10px;">To</span>
      <span class="p-input-icon-right col-12 mb-0 md:col-10 md:mb-0">
        <p-chips [(ngModel)]="resultArray" #chips (onAdd)="onAddE($event)" (onRemove)="onRemoveE($event)">
        </p-chips>
        <input id="to" type="text" pInputText [(ngModel)]="newMail.to" (input)="filterMails()"
          (keyup.enter)="newValueDetails()" (blur)="updateValueNew()"
          class="w-full pl-0 text-900 font-semibold p-inputtext-sm" style="position: relative;
                bottom: 45px;
                border-bottom: none;
                outline: none;
                box-shadow: none;
                border-bottom-left-radius: 0;
                border-bottom-right-radius: 0;" autocomplete="off" />
        <ul *ngIf="filteredMails.length > 0" class="card autocomplete-list" style="    margin: 5px;
                    text-align: left;
                    padding-left: 0;">
          <li *ngFor="let item of filteredMails" (click)="onSelect(item)">
            {{ item.name }}
          </li>
        </ul>
      </span>
    </div>
    <div class="col-6 field flex flex-wrap" style="margin-top: 3px;">
      <span for="template" class="text-900 font-semibold col-12 mb-0 md:col-2 md:mb-0"
        style="padding-top: 10px;">CC</span>
      <span class="p-input-icon-right col-12 mb-0 md:col-10 md:mb-0">
        <p-chips [(ngModel)]="resultArrayCC" #chips (onAdd)="onAddECC($event)" (onRemove)="onRemoveECC($event)">
        </p-chips>
        <input id="cc" type="text" pInputText [(ngModel)]="fld_CC" (input)="filterMailsCC()"
          (keyup.enter)="newValueDetailsCC()" (blur)="updateValueNewCC()"
          class="w-full pl-0 text-900 font-semibold p-inputtext-sm" style="position: relative;
                    bottom: 45px;
                    border-bottom: none;
                    outline: none;
                    box-shadow: none;
                    border-bottom-left-radius: 0;
                    border-bottom-right-radius: 0;" autocomplete="off" />
        <ul *ngIf="filteredMailsCC.length > 0" class="card autocomplete-list" style="    margin: 5px;
                        text-align: left;
                        padding-left: 0;">
          <li *ngFor="let item of filteredMailsCC" (click)="onSelectCC(item)">
            {{ item.name }}
          </li>
        </ul>
      </span>
    </div>
    <div class="col-6 field flex flex-wrap">
      <span for="template" class="text-900 font-semibold col-12 mb-0 md:col-2 md:mb-0"
        style="padding-top: 10px;">BCC</span>
      <span class="p-input-icon-right col-12 mb-0 md:col-10 md:mb-0">
        <p-chips [(ngModel)]="resultArrayBCC" #chips (onAdd)="onAddEBCC($event)" (onRemove)="onRemoveEBCC($event)">
        </p-chips>
        <input id="bcc" type="text" pInputText [(ngModel)]="fld_BCC" (input)="filterMailsBCC()"
          (keyup.enter)="newValueDetailsBCC()" (blur)="updateValueNewBCC()"
          class="w-full pl-0 text-900 font-semibold p-inputtext-sm" style="position: relative;
                    bottom: 45px;
                    border-bottom: none;
                    outline: none;
                    box-shadow: none;
                    border-bottom-left-radius: 0;
                    border-bottom-right-radius: 0;" autocomplete="off" />
        <ul *ngIf="filteredMailsBCC.length > 0" class="card autocomplete-list" style="    margin: 5px;
                        text-align: left;
                        padding-left: 0;">
          <li *ngFor="let item of filteredMailsBCC" (click)="onSelectBCC(item)">
            {{ item.name }}
          </li>
        </ul>
      </span>
    </div>
    <div class="col-6 field flex flex-wrap">
      <span for="Subject" class="text-900 font-semibold col-12 mb-0 md:col-2 md:mb-0"
        style="padding-top: 10px;">Subject</span>
      <span class="p-input-icon-right  col-12 mb-0 md:col-10 md:mb-0">

        <input id="subject" type="text" pInputText [(ngModel)]="newMail.title" placeholder="Subject"
          class="w-full pl-7 text-900 font-semibold p-inputtext-sm newAddedOne" autocomplete="off" />
        <i class="pi pi-pencil" style="right: 1.5rem;"></i>
      </span>
    </div>
    <div class="col-6 field flex flex-wrap">
      <span for="template" class="text-900 font-semibold col-12 mb-0 md:col-2 md:mb-0"
        style="padding-top: 10px;">Template</span>
      <span class="p-input-icon-right col-12 mb-0 md:col-10 md:mb-0">
        <p-dropdown [options]="templateArr" [(ngModel)]="selectTemp" optionLabel="label" optionValue="value"
          placeholder="Select Template" class="p-inputtext-sm gettingDataCls newCssAdded" optionValue="value"
          (click)="getTemplate()" (onSelect)="selectedReplyTemplate($event)"
          (onChange)="selectedReplyTemplate($event)"></p-dropdown>
      </span>
    </div>

    <div class="col-12" style="padding: 0 14px;">
      <p-fileUpload  maxFileSize="5000000000000" [multiple]="true" customUpload="true"
        (uploadHandler)="uploadHandler($event)" (onComplete)="onUpload($event)" [multiple]="true">
      </p-fileUpload>
    </div>
    <div class="col-12 field" style="padding: 0 14px;">
      <p-editor [style]="{'height':'150px'}" [(ngModel)]="newMail.message"></p-editor>
      <div *ngIf="signature" style="border: 1px solid lightgray; 
        max-height: 100%;
        border-radius: 8px;
        height: auto;
        padding: 20px;" [readonly]="true" [innerHTML]="signature | htmlconverter"></div>

    </div>
    <div class="col-12 field" style="padding: 0 14px;">
      <p-button label="New Ticket" (onClick)="newTicket()" [hidden]="!ticketEnable"></p-button>
    </div>
    <div class="col-12 field" style="padding: 0 14px;">
      <!-- ticketing dashboard start -->
      <div class="p-fluid formgrid grid overflow-y-auto" style="padding: 10px;
       width: 100%;
       margin: auto;" *ngIf="newTicketFlag1">
        <div class="col-12 md:col-12 card">

          <div class="cardTicket dispositioncard2">
            <div class="cardTicket" *ngIf="showTicketCard">
              <form [formGroup]="customForm">
                <div>
                  <div class=" dynamic-form-card">
                    <div class="p-fluid formgrid grid">
                      <ng-container *ngFor="let field of formFields">
                        <div *ngIf="field.fld_isNewRow==true"
                          style="min-inline-size: -webkit-fill-available !important;">
                        </div>
                        <div class="field col-12 md:col-12" *ngIf="field.isSeparator==true">{{field.separatorText}}
                        </div>
                        <div style="font-size:11px !important; margin-top:5px;" class="field col-12 md:col-2"
                          *ngIf="field.fld_Enable_Search==false">
                          <span style="padding-left:10px; ">{{field.name}}</span>
                        </div>
                        <div class="field col-12 md:col-2">
                          <span
                            *ngIf="field.controlType.value == 0 && field.displayInClient==true && field.isUsed==true && field.isUsed==true && field.fld_Enable_Search==false">
                            <div
                              *ngIf="field.name == 'Phone Number' || field.name == 'PhoneNo' || field.name == 'PhoneNo*' || field.name == 'Phone No'">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName" *ngIf="!isMasked"
                                required="field.required" class="p-inputtext-sm" style=" user-select: none !important;">

                              <input type="text" pInputText id="phoneInput" *ngIf="isMasked" required="field.required"
                                class="p-inputtext-sm" style=" user-select: none !important;">

                            </div>

                            <!-- <div *ngIf="!(field.name == 'Phone Number')"> -->
                            <div
                              *ngIf="!(field.name == 'Phone Number' ||  field.name == 'PhoneNo' || field.name == 'PhoneNo*'  || field.name == 'Phone No')">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable">
                            </div>
                          </span>
                          <span
                            *ngIf="field.fld_Enable_Search==true && field.isUsed==true && myStudentFiledTrueFalse && !teacherFiledTrueFalse">
                            <div
                              *ngIf="field.name === 'Student Id' || field.name === 'Student Name' || field.name === 'Grade'">
                              <div style="font-size:11px !important; margin-top:5px;">
                                <span style="padding-left:10px; ">{{field.name}}</span>
                              </div>
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                style="user-select: none !important;">
                            </div>
                          </span>
                          <span
                            *ngIf="field.fld_Enable_Search==true && field.isUsed==true && teacherFiledTrueFalse && !myStudentFiledTrueFalse">
                            <div
                              *ngIf="field.name === 'Teacher Code' || field.name === 'Teacher Name' || field.name === 'Registered Mobile Number'">
                              <div style="font-size:11px !important; margin-top:5px;">
                                <span style="padding-left:10px; ">{{field.name}}</span>
                              </div>
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                style="user-select: none !important;">
                            </div>
                          </span>
                          <span
                            *ngIf="field.controlType.value == 2 && field.displayInClient==true && field.isUsed==true ">
                            <ng-container *ngIf="!hideDropDownEnableDIsable">
                              <div *ngIf="field.name === 'School Code'">
                                <!-- <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                                         class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                                         required="field.required" placeholder="select" [readonly]="!field.isEditable"  (onSelect)="firstParentValue($event,field)" (onChange)="firstParentValue($event,field)"
                                                         [filter]="true" filterBy="label">
                                                     </p-dropdown> -->
                                <p-dropdown [options]="selctedSchoolCode" [(ngModel)]="schoolCodeValue"
                                  placeholder="Select" [editable]="true" [ngModelOptions]="{standalone: true}"
                                  [filter]="true" filterBy="sclCode" (onFilter)="customFilterFunction($event)"
                                  (onClear)="ocClearData($event)" optionLabel="sclCode"
                                  (onSelect)="checkValueAfterClick($event)" (onChange)="checkValueAfterClick($event)">
                                  <ng-template pTemplate="selectedItem" let-selectedUser>
                                    <div class="selectedUser-item">
                                      <div>{{selectedUser.sclCode}}</div>
                                    </div>
                                  </ng-template></p-dropdown>
                              </div>
                              <ng-container>
                                <div *ngIf="field.name === 'School Name'">
                                  <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="schoolNameValue"
                                    [ngModelOptions]="{standalone: true}" />
                                </div>
                                <div *ngIf="field.name === 'District'">
                                  <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="districtValue"
                                    [ngModelOptions]="{standalone: true}" />
                                </div>
                                <div *ngIf="field.name === 'Block Name'">
                                  <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="blockNameValue"
                                    [ngModelOptions]="{standalone: true}" />
                                </div>
                              </ng-container>

                            </ng-container>
                            <ng-container
                              *ngIf="hideDropDownEnableDIsable && field.name != 'Designation' && field.name != 'Problem Reported' && field.name != 'Problem Category' && field.name != 'Dependent upon (State/CG)' &&  field.name != 'Bot Name'">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                style="user-select: none !important;">
                              <span (click)="returnDropDownFirst" *ngIf="field.name === 'School Code'" style="    position: relative; 
                                          float: right;
                                          bottom: 43px;
                                          left: 6px;">
                                <i class="pi pi-times-circle" style="font-size: 20px" (click)="returnDropDownFirst()"
                                  sty></i>
                              </span>
                            </ng-container>
                            <ng-container
                              *ngIf="hidePropertyValueEnable && field.name != 'Designation'   &&  field.name != 'Bot Name' && field.name != 'District' &&  field.name != 'School Name' && field.name != 'School Code' && field.name != 'Block Name'">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                                style="user-select: none !important;">
                              <span (click)="returnDropDownSecond" *ngIf="field.name === 'Problem Reported'" style="    position: relative;
                                          float: right;
                                          bottom: 43px;
                                          left: 6px;">
                                <i class="pi pi-times-circle" style="font-size: 20px"
                                  (click)="returnDropDownSecond()"></i>
                              </span>
                            </ng-container>
                            <div
                              *ngIf="field.name != 'District' &&  field.name != 'School Name' && field.name != 'School Code' && field.name != 'Block Name' && field.name != 'Problem Reported' && field.name != 'Problem Category' && field.name != 'Dependent upon (State/CG)'">
                              <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                (onSelect)="getingBotNameValue($event,field)"
                                (onChange)="getingBotNameValue($event,field)" class="p-inputtext-sm"
                                [formControlName]="field.fld_FieldName" required="field.required" placeholder="select"
                                [readonly]="!field.isEditable" [filter]="true" filterBy="label">
                              </p-dropdown>
                            </div>
                            <ng-container *ngIf="!hidePropertyValueEnable">
                              <div *ngIf="field.name === 'Problem Reported'">
                                <!-- <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                                     class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                                     required="field.required" placeholder="select" [readonly]="!field.isEditable"  (onSelect)="firstProblemDropDownValue($event,field)" (onChange)="firstProblemDropDownValue($event,field)"
                                                     [filter]="true" filterBy="label">
                                                 </p-dropdown> -->
                                <p-dropdown [options]="getValueParakhBot" [(ngModel)]="problemReportedValue"
                                  [ngModelOptions]="{standalone: true}" optionLabel="value" optionValue="value"
                                  class="p-inputtext-sm" placeholder="Select"
                                  (onSelect)="firstProblemDropDownValue($event,field)"
                                  (onChange)="firstProblemDropDownValue($event,field)" [filter]="true" filterBy="value">
                                  <ng-template pTemplate="selectedItem" let-selectedUser>
                                    <div class="selectedUser-item" style="width: 100px !important;">
                                      <div>{{selectedUser.value}}</div>
                                    </div>
                                  </ng-template>
                                </p-dropdown>
                              </div>
                              <div *ngIf="field.name === 'Problem Category' && mainProblemDropDownValue">
                                <p-dropdown [options]="ProblemCategoryArr" optionlabel="label" optionValue="value"
                                  class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                  required="field.required" placeholder="select" [readonly]="!field.isEditable"
                                  (onSelect)="ProblemCategoryVFun($event,field)"
                                  (onChange)="ProblemCategoryVFun($event,field)" [filter]="true" filterBy="label">
                                </p-dropdown>
                              </div>
                              <div *ngIf="field.name === 'Problem Category' && !mainProblemDropDownValue">
                                <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                  class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                  required="field.required" placeholder="select" [readonly]="!field.isEditable"
                                  (onSelect)="ProblemCategoryVFun($event,field)"
                                  (onChange)="ProblemCategoryVFun($event,field)" [filter]="true" filterBy="label">
                                </p-dropdown>
                              </div>
                              <div *ngIf="field.name === 'Dependent upon (State/CG)' && mainNewVariableCheckDepenedent">
                                <p-dropdown [options]="dependentVariavbles" optionlabel="label" optionValue="value"
                                  class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                  required="field.required" placeholder="select" [readonly]="!field.isEditable"
                                  (onSelect)="DependentuponFunc($event,field)"
                                  (onChange)="DependentuponFunc($event,field)" [filter]="true" filterBy="label">
                                </p-dropdown>
                              </div>
                              <div
                                *ngIf="field.name === 'Dependent upon (State/CG)' && !mainNewVariableCheckDepenedent">
                                <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                  class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                  required="field.required" placeholder="select" [readonly]="!field.isEditable"
                                  (onSelect)="DependentuponFunc($event,field)"
                                  (onChange)="DependentuponFunc($event,field)" [filter]="true" filterBy="label">
                                </p-dropdown>
                              </div>
                            </ng-container>

                          </span>

                          <span
                            *ngIf="field.controlType.value == 3 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-checkbox binary="true" inputId="binary" [formControlName]="field.fld_FieldName"
                                required="field.required" [readonly]="!field.isEditable">
                              </p-checkbox>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 4 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-radioButton [formControlName]="field.fld_FieldName" required="field.required"
                                [readonly]="!field.isEditable">
                              </p-radioButton>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 5 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-listbox [formControlName]="field.fld_FieldName" optionLabel="name"
                                required="field.required" [readonly]="!field.isEditable"></p-listbox>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 1 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <textarea pInputTextarea [formControlName]="field.fld_FieldName" required="field.required"
                                [readonly]="!field.isEditable"></textarea>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 8 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-multiSelect [options]="cities" class="p-inputtext-sm" optionLabel="name"
                                required="field.required" [formControlName]="field.fld_FieldName" placeholder="select"
                                [readonly]="!field.isEditable"></p-multiSelect>
                            </div>
                          </span>
                        </div>
                      </ng-container>
                    </div>
                    <!-- <div class="field col-12 md:col-5 flex">
                                 <p-button label="New Ticket" (onClick)="newTicket()" [hidden]="!ticketEnable"></p-button>
                                 <div style="margin: 0 5px;"></div>
                                 <p-button label="Open DM Chat" (click)="dmChat()" [hidden]="!liveDM"></p-button>
                             </div> -->
                  </div>
                </div>
              </form>
              <!-- assign by && Ticket Status -->
              <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-2 md:mb-0">Assigned By:<span style="color:red">*</span></div>
                <div class="col-12 mb-0 md:col-3 md:mb-0">
                  <input type="text" pInputText [(ngModel)]="selectedAssignedBy" readonly="true"
                    class="p-inputtext-sm" />
                </div>

                <div class="col-12 mb-0 md:col-2 md:mb-0">Ticket Status<span style="color:red">*</span></div>
                <div class="col-12 mb-0 md:col-3 md:mb-0">
                  <p-dropdown class="p-inputtext-sm" id="ticketStatus" [options]="ticketStatusDropdownData"
                    [disabled]="disabledTicketFields" [filter]="true" filterBy="label" optionLabel="label"
                    optionValue="value" [(ngModel)]="selectedticketStatus" [showClear]="true" placeholder="Select"
                    (onClick)="getTicketStatus()">
                    <ng-template let-selectedType pTemplate="item">
                      <div class="selectedType-item">
                        <div>{{selectedType.label}}</div>
                      </div>
                    </ng-template>
                  </p-dropdown>
                </div>
              </div>

              <!-- ticket type -->
              <!-- <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                         <div class="col-12 mb-0 md:col-2 md:mb-0 ">Ticket Type:<span style="color:red">*</span></div>
                         <div class="col-12 mb-0 md:col-3 md:mb-0">
                             <i class="pi pi-chevron-circle-left" style="font-size: 1.7rem"
                                 (click)="previousIconTicketType()"></i>
                             <p-dropdown class="p-inputtext-sm" id="ticketType" [options]="ticketTypeDropdownData"
                                 appendTo="body" [disabled]="disabledTicketFields" [filter]="true" filterBy="label"
                                 optionLabel="label" optionValue="value" [(ngModel)]="selectedTicketType" [showClear]="true"
                                 placeholder="Select ">
                                 <ng-template let-selectedType pTemplate="item">
                                     <div class="selectedType-item">
                                         <div>{{selectedType.label}}</div>
                                     </div>
                                 </ng-template>
                             </p-dropdown>
                             <i class="pi pi-chevron-circle-right" style="font-size: 1.7rem"
                                 (click)="forwardIconTicketType()"></i>
                         </div>
                     </div> -->

              <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-2 md:mb-0 ">Ticket Type:<span style="color:red">*</span></div>

                <!-- 1st Dropdown -->
                <div class="col-12 mb-0 md:col-3 md:mb-0" *ngFor="let item of arrObj; let i = index">
                  <p-dropdown class="p-inputtext-sm" id="ticketType[i]" [options]="ticketTypeDropdownData[i]"
                    [disabled]="disabledTicketFields" appendTo="body" [filter]="true" filterBy="label"
                    optionLabel="label" optionValue="value" [(ngModel)]="selectedTicketType[i] " [showClear]="true"
                    placeholder="Select" (onChange)="ticketTypeDropdown(i)">
                    <ng-template let-selectedType pTemplate="item">
                      <div class="selectedType-item">
                        <div>{{selectedType.label}}</div>
                      </div>
                    </ng-template>
                  </p-dropdown>
                </div>

              </div>


              <!-- tree -->
              <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-12 md:mb-0">Tree : {{tree}}</div>

              </div>

              <!-- voice file -->
              <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;"
                *ngIf="voicefile">
                <div class="col-12 mb-0 md:col-2 md:mb-0">Voice File:</div>
                <div class="col-12 mb-0 md:col-6 md:mb-0">
                  <audio controls>
                    <source [src]="voicefile" type="audio/wav">
                  </audio>
                </div>
              </div>

              <!-- agent remarks && moved to below just above the callback section -->
              <!-- <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                         <div class="col-12 mb-0 md:col-2 md:mb-0">Agent Remarks:</div>
                         <div class="col-12 mb-0 md:col-6 md:mb-0">
                             <textarea rows="2" cols="40" id="agentRemarks" name="agentRemarks" pInputTextarea
                                 [disabled]="disabledTicketFields" placeholder=" " [(ngModel)]="agentRemarks"></textarea>
                         </div>
                     </div> -->
            </div>

            <div class="cardTicket" *ngIf="showDynaTicketCard">
              <form [formGroup]="ticketForm">
                <div>
                  <div class="dynamic-form-card">
                    <div class="p-fluid formgrid grid" style="padding-left: 10px !important; margin-top:10px;">
                      <ng-container *ngFor="let field of ticketFields">
                        <div *ngIf="field.fld_isNewRow==true"
                          style="min-inline-size: -webkit-fill-available !important;">
                        </div>
                        <div class="field col-12 md:col-12" *ngIf="field.isSeparator==true">
                          <div class="flex flex-wrap">
                            <span>{{field.separatorText}}</span>
                            <span class="remaining-space"></span>
                          </div>
                        </div>
                        <div style="font-size:11px !important; margin-top:5px;" class="field col-12 md:col-2"
                          *ngIf="field.displayInClient==true && field.isUsed==true">
                          <span>{{field.name}}</span>
                        </div>
                        <div class="field col-12 md:col-2">
                          <span
                            *ngIf="field.controlType.value == 0 && field.displayInClient==true && field.isUsed==true && field.isUsed==true">
                            <div *ngIf="field.name === 'Phone Number'">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm">
                            </div>

                            <div *ngIf="!(field.name == 'Phone Number')">
                              <input type="text" pInputText [formControlName]="field.fld_FieldName"
                                required="field.required" class="p-inputtext-sm">
                            </div>

                          </span>

                          <span
                            *ngIf="field.controlType.value == 3 && field.displayInClient==true && field.isUsed==true">
                            <div>

                              <p-checkbox binary="true" inputId="binary" [formControlName]="field.fld_FieldName"
                                required="field.required">
                              </p-checkbox>
                            </div>

                          </span>

                          <span
                            *ngIf="field.controlType.value == 4 && field.displayInClient==true && field.isUsed==true">
                            <div *ngFor="let radioOption of field.selectItems">
                              <p-radioButton binary="true" inputId="binary" [value]="radioOption.value"
                                [formControlName]="field.fld_FieldName"></p-radioButton>
                              <label class="ml-2">{{ radioOption.label }}</label>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 7 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-calendar [formControlName]="field.fld_FieldName" optionLabel="name"
                                required="field.required"></p-calendar>
                            </div>
                          </span>

                          <span
                            *ngIf="field.controlType.value == 1 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <textarea pInputTextarea [formControlName]="field.fld_FieldName"
                                required="field.required"></textarea>
                            </div>
                          </span>

                          <!-- <span
                                                 *ngIf="field.controlType.value == 5 && field.displayInClient==true && field.isUsed==true">
                                                 <div>
                                                     <p-multiSelect [options]="field.selectItems" class="p-inputtext-sm"
                                                         optionLabel="label" optionValue="value" required="field.required"
                                                         [formControlName]="field.fld_FieldName"
                                                         defaultLabel="Select a City"></p-multiSelect>
                                                 </div>
                                             </span> -->
                          <span
                            *ngIf="field.controlType.value == 5 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-multiSelect [options]="field.selectItems" class="p-inputtext-sm" optionLabel="label"
                                optionValue="value" [formControlName]="field.fld_FieldName"
                                defaultLabel="Select Value"></p-multiSelect>
                            </div>

                          </span>

                          <!-- <span
                                             *ngIf="field.controlType.value == 8 && field.displayInClient==true && field.isUsed==true">
                                             <div *ngFor="let category of field.selectItems" class="field-checkbox">
                                                 <p-checkbox name="group" [value]="category.value" [formControlName]="field.fld_FieldName" [inputId]="category.key"></p-checkbox>
                                                 <label [for]="category.key">{{ category.label }}</label>
                                             </div>
                                             </span> -->

                          <span
                            *ngIf="field.controlType.value == 8 && field.displayInClient == true && field.isUsed == true">
                            <div *ngFor="let category of field.selectItems" class="field-checkbox">
                              <p-checkbox name="group" [value]="category.value" [(ngModel)]="abc"
                                [formControlName]="field.fld_FieldName" [inputId]="category.key"></p-checkbox>
                              <label [for]="category.key">{{ category.label }}</label>

                            </div>
                            <!-- {{category.value |json}} -->
                          </span>


                          <span
                            *ngIf="field.controlType.value == 2 && field.displayInClient==true && field.isUsed==true">
                            <div>
                              <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                                placeholder="select" [filter]="true" filterBy="label">
                              </p-dropdown>
                            </div>
                          </span>
                        </div>

                      </ng-container>
                    </div>
                  </div>
                </div>
              </form>

            </div>

            <div class="cardTicket" *ngIf="showTicketCard">
              <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                <div class="col-12 mb-0 md:col-2 md:mb-0">Agent Remarks:</div>
                <div class="col-12 mb-0 md:col-6 md:mb-0">
                  <textarea rows="2" cols="40" id="agentRemarks" name="agentRemarks" pInputTextarea class="p-inputtext"
                    [disabled]="disabledTicketFields" placeholder=" " [(ngModel)]="agentRemarks"></textarea>
                </div>
              </div>
            </div>


            <div class="cardTicket" *ngIf="showTicketCard">
              <div class="grid forms-grid flex-row p-fluid"
                style="padding-left: 10px !important; margin-top:10px;padding-bottom: 11px;">

                <!-- <div class="col-12 mb-0 md:col-1 md:mb-0">
                       <div>Ticket Id</div>
                     </div>
                     <div class="col-12 mb-0 md:col-2 md:mb-0">
                       <div><input class="p-inputtext-sm" type="text" pInputText [(ngModel)]="ticketNo" /></div>
                     </div> -->

                <!-- <div class="col-12 mb-0 md:col-3 md:mb-0">
                       <button (click)="callHistory()" pButton pRipple type="button" label="Ticket History"
                         style="background: #128c7e;    white-space: pre;
    width: 100%;">
                       </button>
                     </div> -->
                <div class="col-12 mb-0 md:col-2 md:mb-0">
                  <button pButton pRipple type="submit" style="background: #128c7e;" label="Save"
                    (click)="saveDynamicLeadCustField()" *ngIf="showSaveButton">
                  </button>
                  <!-- <button pButton pRipple type="submit" style="background: #128c7e;" label="Save" (click)="saveTicketData()"
                                 *ngIf="showSaveButton">
                             </button> -->

                  <button pButton (click)="updateTiecket()" pButton pRipple style="background: #128c7e;" type="Update"
                    label="Update" *ngIf="showUpdateButton">
                  </button>
                </div>
              </div>
            </div>
          </div>



        </div>
      </div>
      <!-- ticketing dashboard end-->
    </div>
    <div class="col-12 flex column-gap-3 justify-content-end">
      <!-- <button pButton pRipple type="button" class="p-button-primary h-3rem w-full sm:w-auto" icon="pi pi-send"
          label="Draft" (click)="draftMail()"></button> &nbsp;&nbsp;&nbsp; -->
      <!-- <button pButton pRipple type="button" class="p-button-primary h-3rem w-full sm:w-auto" icon="pi pi-send"   [disabled]="!valueSaveTrue"
          label="Send" (click)="sendMail()"></button> -->
      <button pButton pRipple type="button" class="p-button-primary h-3rem w-full sm:w-auto" icon="pi pi-send"
        label="Send" (click)="sendMail()"></button>
    </div>
  </div>
</p-dialog>

<!-- email code dynamic end -->

<!-- ticket Data -->
<p-dialog position="center" [(visible)]="historyDialogBox" [style]="{width: '85vw'}" header="Ticket History"
  [modal]="true" styleClass="p-fluid">
  <form [formGroup]="customForm">
    <div>
      <div class=" dynamic-form-card">
        <div class="p-fluid formgrid grid">
          <ng-container *ngFor="let field of formFields">
            <div *ngIf="field.fld_isNewRow==true" style="min-inline-size: -webkit-fill-available !important;">
            </div>
            <div class="field col-12 md:col-12" *ngIf="field.isSeparator==true">{{field.separatorText}}</div>
            <div style="font-size:11px !important; margin-top:5px;" class="field col-12 md:col-2"
              *ngIf="field.fld_Enable_Search==false">
              <span style="padding-left:10px; ">{{field.name}}</span>
            </div>
            <div class="field col-12 md:col-2">
              <span
                *ngIf="field.controlType.value == 0 && field.displayInClient==true && field.isUsed==true && field.isUsed==true && field.fld_Enable_Search==false">
                <div
                  *ngIf="field.name == 'Phone Number' || field.name == 'PhoneNo' || field.name == 'PhoneNo*' || field.name == 'Phone No'">
                  <input type="text" pInputText [formControlName]="field.fld_FieldName" *ngIf="!isMasked"
                    required="field.required" class="p-inputtext-sm" style=" user-select: none !important;">

                  <input type="text" pInputText id="phoneInput" *ngIf="isMasked" required="field.required"
                    class="p-inputtext-sm" style=" user-select: none !important;">

                </div>

                <!-- <div *ngIf="!(field.name == 'Phone Number')"> -->
                <div
                  *ngIf="!(field.name == 'Phone Number' ||  field.name == 'PhoneNo' || field.name == 'PhoneNo*'  || field.name == 'Phone No')">
                  <input type="text" pInputText [formControlName]="field.fld_FieldName" required="field.required"
                    class="p-inputtext-sm" [readonly]="!field.isEditable">
                </div>
              </span>
              <span
                *ngIf="field.fld_Enable_Search==true && field.isUsed==true && myStudentFiledTrueFalse && !teacherFiledTrueFalse">
                <div *ngIf="field.name === 'Student Id' || field.name === 'Student Name' || field.name === 'Grade'">
                  <div style="font-size:11px !important; margin-top:5px;">
                    <span style="padding-left:10px; ">{{field.name}}</span>
                  </div>
                  <input type="text" pInputText [formControlName]="field.fld_FieldName" required="field.required"
                    class="p-inputtext-sm" [readonly]="!field.isEditable" style="user-select: none !important;">
                </div>
              </span>
              <span
                *ngIf="field.fld_Enable_Search==true && field.isUsed==true && teacherFiledTrueFalse && !myStudentFiledTrueFalse">
                <div
                  *ngIf="field.name === 'Teacher Code' || field.name === 'Teacher Name' || field.name === 'Registered Mobile Number'">
                  <div style="font-size:11px !important; margin-top:5px;">
                    <span style="padding-left:10px; ">{{field.name}}</span>
                  </div>
                  <input type="text" pInputText [formControlName]="field.fld_FieldName" required="field.required"
                    class="p-inputtext-sm" [readonly]="!field.isEditable" style="user-select: none !important;">
                </div>
              </span>
              <span *ngIf="field.controlType.value == 2 && field.displayInClient==true && field.isUsed==true ">
                <ng-container *ngIf="!hideDropDownEnableDIsable">
                  <div *ngIf="field.name === 'School Code'">
                    <!-- <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                          class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                          required="field.required" placeholder="select" [readonly]="!field.isEditable"  (onSelect)="firstParentValue($event,field)" (onChange)="firstParentValue($event,field)"
                                          [filter]="true" filterBy="label">
                                      </p-dropdown> -->
                    <p-dropdown [options]="selctedSchoolCode" [(ngModel)]="schoolCodeValue" placeholder="Select"
                      [editable]="true" [ngModelOptions]="{standalone: true}" [filter]="true" filterBy="sclCode"
                      (onFilter)="customFilterFunction($event)" (onClear)="ocClearData($event)" optionLabel="sclCode"
                      (onSelect)="checkValueAfterClick($event)" (onChange)="checkValueAfterClick($event)">
                      <ng-template pTemplate="selectedItem" let-selectedUser>
                        <div class="selectedUser-item">
                          <div>{{selectedUser.sclCode}}</div>
                        </div>
                      </ng-template></p-dropdown>
                  </div>
                  <ng-container>
                    <div *ngIf="field.name === 'School Name'">
                      <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="schoolNameValue"
                        [ngModelOptions]="{standalone: true}" />
                    </div>
                    <div *ngIf="field.name === 'District'">
                      <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="districtValue"
                        [ngModelOptions]="{standalone: true}" />
                    </div>
                    <div *ngIf="field.name === 'Block Name'">
                      <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="blockNameValue"
                        [ngModelOptions]="{standalone: true}" />
                    </div>
                  </ng-container>

                </ng-container>
                <ng-container
                  *ngIf="hideDropDownEnableDIsable && field.name != 'Designation' && field.name != 'Problem Reported' && field.name != 'Problem Category' && field.name != 'Dependent upon (State/CG)' &&  field.name != 'Bot Name'">
                  <input type="text" pInputText [formControlName]="field.fld_FieldName" required="field.required"
                    class="p-inputtext-sm" [readonly]="!field.isEditable" style="user-select: none !important;">
                  <span (click)="returnDropDownFirst" *ngIf="field.name === 'School Code'" style="    position: relative; 
                           float: right;
                           bottom: 43px;
                           left: 6px;">
                    <i class="pi pi-times-circle" style="font-size: 20px" (click)="returnDropDownFirst()" sty></i>
                  </span>
                </ng-container>
                <ng-container
                  *ngIf="hidePropertyValueEnable && field.name != 'Designation'   &&  field.name != 'Bot Name' && field.name != 'District' &&  field.name != 'School Name' && field.name != 'School Code' && field.name != 'Block Name'">
                  <input type="text" pInputText [formControlName]="field.fld_FieldName" required="field.required"
                    class="p-inputtext-sm" [readonly]="!field.isEditable" style="user-select: none !important;">
                  <span (click)="returnDropDownSecond" *ngIf="field.name === 'Problem Reported'" style="    position: relative;
                           float: right;
                           bottom: 43px;
                           left: 6px;">
                    <i class="pi pi-times-circle" style="font-size: 20px" (click)="returnDropDownSecond()"></i>
                  </span>
                </ng-container>
                <div
                  *ngIf="field.name != 'District' &&  field.name != 'School Name' && field.name != 'School Code' && field.name != 'Block Name' && field.name != 'Problem Reported' && field.name != 'Problem Category' && field.name != 'Dependent upon (State/CG)'">
                  <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                    (onSelect)="getingBotNameValue($event,field)" (onChange)="getingBotNameValue($event,field)"
                    class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                    placeholder="select" [readonly]="!field.isEditable" [filter]="true" filterBy="label">
                  </p-dropdown>
                </div>
                <ng-container *ngIf="!hidePropertyValueEnable">
                  <div *ngIf="field.name === 'Problem Reported'">
                    <!-- <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                      class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                      required="field.required" placeholder="select" [readonly]="!field.isEditable"  (onSelect)="firstProblemDropDownValue($event,field)" (onChange)="firstProblemDropDownValue($event,field)"
                                      [filter]="true" filterBy="label">
                                  </p-dropdown> -->
                    <p-dropdown [options]="getValueParakhBot" [(ngModel)]="problemReportedValue"
                      [ngModelOptions]="{standalone: true}" optionLabel="value" optionValue="value"
                      class="p-inputtext-sm" placeholder="Select" (onSelect)="firstProblemDropDownValue($event,field)"
                      (onChange)="firstProblemDropDownValue($event,field)" [filter]="true" filterBy="value">
                      <ng-template pTemplate="selectedItem" let-selectedUser>
                        <div class="selectedUser-item" style="width: 100px !important;">
                          <div>{{selectedUser.value}}</div>
                        </div>
                      </ng-template>
                    </p-dropdown>
                  </div>
                  <div *ngIf="field.name === 'Problem Category' && mainProblemDropDownValue">
                    <p-dropdown [options]="ProblemCategoryArr" optionlabel="label" optionValue="value"
                      class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                      placeholder="select" [readonly]="!field.isEditable" (onSelect)="ProblemCategoryVFun($event,field)"
                      (onChange)="ProblemCategoryVFun($event,field)" [filter]="true" filterBy="label">
                    </p-dropdown>
                  </div>
                  <div *ngIf="field.name === 'Problem Category' && !mainProblemDropDownValue">
                    <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                      class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                      placeholder="select" [readonly]="!field.isEditable" (onSelect)="ProblemCategoryVFun($event,field)"
                      (onChange)="ProblemCategoryVFun($event,field)" [filter]="true" filterBy="label">
                    </p-dropdown>
                  </div>
                  <div *ngIf="field.name === 'Dependent upon (State/CG)' && mainNewVariableCheckDepenedent">
                    <p-dropdown [options]="dependentVariavbles" optionlabel="label" optionValue="value"
                      class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                      placeholder="select" [readonly]="!field.isEditable" (onSelect)="DependentuponFunc($event,field)"
                      (onChange)="DependentuponFunc($event,field)" [filter]="true" filterBy="label">
                    </p-dropdown>
                  </div>
                  <div *ngIf="field.name === 'Dependent upon (State/CG)' && !mainNewVariableCheckDepenedent">
                    <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                      class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                      placeholder="select" [readonly]="!field.isEditable" (onSelect)="DependentuponFunc($event,field)"
                      (onChange)="DependentuponFunc($event,field)" [filter]="true" filterBy="label">
                    </p-dropdown>
                  </div>
                </ng-container>

              </span>

              <span *ngIf="field.controlType.value == 3 && field.displayInClient==true && field.isUsed==true">
                <div>
                  <p-checkbox binary="true" inputId="binary" [formControlName]="field.fld_FieldName"
                    required="field.required" [readonly]="!field.isEditable">
                  </p-checkbox>
                </div>
              </span>

              <span *ngIf="field.controlType.value == 4 && field.displayInClient==true && field.isUsed==true">
                <div>
                  <p-radioButton [formControlName]="field.fld_FieldName" required="field.required"
                    [readonly]="!field.isEditable">
                  </p-radioButton>
                </div>
              </span>

              <span *ngIf="field.controlType.value == 5 && field.displayInClient==true && field.isUsed==true">
                <div>
                  <p-listbox [formControlName]="field.fld_FieldName" optionLabel="name" required="field.required"
                    [readonly]="!field.isEditable"></p-listbox>
                </div>
              </span>

              <span *ngIf="field.controlType.value == 1 && field.displayInClient==true && field.isUsed==true">
                <div>
                  <textarea pInputTextarea [formControlName]="field.fld_FieldName" required="field.required"
                    [readonly]="!field.isEditable"></textarea>
                </div>
              </span>

              <span *ngIf="field.controlType.value == 8 && field.displayInClient==true && field.isUsed==true">
                <div>
                  <p-multiSelect [options]="cities" class="p-inputtext-sm" optionLabel="name" required="field.required"
                    [formControlName]="field.fld_FieldName" placeholder="select"
                    [readonly]="!field.isEditable"></p-multiSelect>
                </div>
              </span>
            </div>
          </ng-container>
        </div>
        <!-- <div class="field col-12 md:col-5 flex">
                  <p-button label="New Ticket" (onClick)="newTicket()" [hidden]="!ticketEnable"></p-button>
                  <div style="margin: 0 5px;"></div>
                  <p-button label="Open DM Chat" (click)="dmChat()" [hidden]="!liveDM"></p-button>
              </div> -->
      </div>
    </div>
  </form>
  <div *ngFor="let ticketHistory of ticketTypeHistory">
    <div class="cardTicket" style="background-color:#128c7e;">
      <ul style="display: flex; color:white; margin-top:0rem; margin-bottom:0rem; padding-left:0.5rem;font-size: 10px;">
        <li>Ticket Id: {{ticketHistory.ticketID}}</li>
        <span style="margin-left:40px;"></span>
        <li>Source: {{ticketHistory.sourceName}}</li>
        <span style="margin-left:40px;"></span>
        <li>Campaign: {{ticketHistory.campName}}</li>
        <span style="margin-left:40px;"></span>
        <li>ActionNo: {{ticketHistory.action_No}}</li>
        <span style="margin-left:40px;"></span>
        <li>Ticket Time: {{ticketHistory.ticket_Time}}</li>
        <span style="margin-left:40px;"></span>
        <li>Duration: {{ticketHistory.ticketTime}}</li>
      </ul>

    </div>
    <div class="cardTicket">

      <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
        <div class="col-12 mb-0 md:col-2 md:mb-0">Ticket Start Time<span style="color:red">*</span> :</div>
        <div class="col-12 mb-0 md:col-2 md:mb-0">
          <input type="text" pInputText [(ngModel)]="ticketHistory.start_Time" readonly="true" class="p-inputtext-sm" />
        </div>
        <div class="col-12 mb-0 md:col-2 md:mb-0">Ticket End Time<span style="color:red">*</span> :</div>
        <div class="col-12 mb-0 md:col-2 md:mb-0">
          <input type="text" pInputText [(ngModel)]="ticketHistory.ticketElapsedTime" readonly="true"
            class="p-inputtext-sm" />
        </div>
        <div class="col-12 mb-0 md:col-2 md:mb-0">Duration<span style="color:red">*</span> :</div>
        <div class="col-12 mb-0 md:col-2 md:mb-0">
          <input type="text" pInputText [(ngModel)]="ticketHistory.ticketTime" readonly="true" class="p-inputtext-sm" />
        </div>
      </div>

      <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
        <div class="col-12 mb-0 md:col-2 md:mb-0 ">Ticket Type<span style="color:red">*</span>:</div>
        <div class="col-12 mb-0 md:col-2 md:mb-0">
          <input type="text" pInputText [(ngModel)]="ticketHistory.ticket_type_name" readonly="true"
            class="p-inputtext-sm" />
        </div>


        <div class="col-12 mb-0 md:col-2 md:mb-0">Ticket Status<span style="color:red">*</span></div>
        <div class="col-12 mb-0 md:col-2 md:mb-0">
          <input type="text" pInputText [(ngModel)]="ticketHistory.ticket_StatusName" readonly="true"
            class="p-inputtext-sm" />
        </div>


        <div class="col-12 mb-0 md:col-2 md:mb-0">Assigned By<span style="color:red">*</span>:</div>
        <div class="col-12 mb-0 md:col-2 md:mb-0">
          <input type="text" pInputText [(ngModel)]="ticketHistory.assignedByID" readonly="true"
            class="p-inputtext-sm" />
        </div>
      </div>


      <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
        <div class="col-12 mb-0 md:col-2 md:mb-0">UpdateBy<span style="color:red">*</span>:</div>
        <div class="col-12 mb-0 md:col-2 md:mb-0">
          <input type="text" pInputText [(ngModel)]="ticketHistory.updatedByID" readonly="true"
            class="p-inputtext-sm" />
        </div>

        <div class="col-12 mb-0 md:col-2 md:mb-0">Tree :</div>
        <div class="col-12 mb-0 md:col-6 md:mb-0">

        </div>
      </div>

      <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;"
        *ngIf="ticketHistory.voicefile">
        <div class="col-12 mb-0 md:col-2 md:mb-0">Voice File:</div>
        <div class="col-12 mb-0 md:col-6 md:mb-0">
          <audio controls>
            <source [src]="ticketHistory.voicefile" type="audio/wav">
          </audio>
        </div>
      </div>

      <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
        <div class="col-12 mb-0 md:col-2 md:mb-0">Agent Remarks:</div>
        <div class="col-12 mb-0 md:col-6 md:mb-0">
          <textarea rows="2" cols="40" id="agentRemarks" name="agentRemarks" pInputTextarea class="p-inputtext"
            [disabled]="disabledTicketFields" placeholder=" " [(ngModel)]="ticketHistory.remarks"></textarea>
        </div>
      </div>

      <!-- <form [formGroup]="ticketHistoryForm" *ngIf="ticketHistory.objticketDynaField"> -->
      <div *ngIf="ticketHistory.objticketDynaField">
        <div class="dynamic-form-card">
          <div class="p-fluid formgrid grid" style="padding-left: 10px !important; margin-top:10px;">

            <ng-container *ngFor="let field of ticketHistory.objticketDynaField | keyvalue">
              <div *ngIf="field.value.fld_isNewRow==true" style="min-inline-size: -webkit-fill-available !important;">
              </div>
              <div class="field col-12 md:col-12" *ngIf="field.value.isSeparator==true">
                {{field.value.separatorText}}</div>
              <div style="font-size:11px !important; margin-top:5px;" class="field col-12 md:col-2">
                <span>{{field.value.name}}</span>
              </div>
              <div class="field col-12 md:col-2">
                <span
                  *ngIf="field.value.controlType.value == 0 && field.value.displayInClient==true && field.value.isUsed==true && field.value.isUsed==true || 
                                    field.value.controlType.value == 2 && field.value.displayInClient==true && field.value.isUsed==true || field.value.controlType.value == 7 && field.value.displayInClient==true && field.value.isUsed==true ||
                                    field.value.controlType.value == 5 && field.value.displayInClient==true && field.value.isUsed==true">

                  <div *ngIf="field.value.name === 'Phone Number'">
                    <input type="text" pInputText required="field.value.required" class="p-inputtext-sm"
                      [(ngModel)]="field.value.value" readonly="true">
                  </div>
                  <div *ngIf="!(field.value.name == 'Phone Number')">
                    <input type="text" pInputText required="field.value.required" class="p-inputtext-sm"
                      [(ngModel)]="field.value.value" readonly="true">
                  </div>

                </span>

                <span *ngIf="field.value.controlType.value == 8">
                  <div *ngFor="let category of field.value.selectItems" class="field-checkbox">
                    <p-checkbox name="group" [value]="category.value" [(ngModel)]="field.value.value"
                      readonly="true"></p-checkbox>
                    <label [for]="category.key">{{ category.label }}</label>
                  </div>
                  <!-- {{category.value |json}} -->
                </span>
                <span
                  *ngIf="field.value.controlType.value == 3 && field.value.displayInClient==true && field.value.isUsed==true">
                  <div>
                    <!-- {{field.value.value|json}} -->
                    <p-checkbox binary="true" inputId="binary" required="field.value.required"
                      [ngModel]="field.value.value === 'true'" readonly="true">
                    </p-checkbox>
                  </div>
                </span>

                <span *ngIf="field.value.controlType.value == 4">
                  <div *ngFor="let radioOption of field.value.selectItems">
                    <p-radioButton inputId="{{ radioOption.value }}" value="{{ radioOption.value }}"
                      [(ngModel)]="field.value.value" disabled="true"></p-radioButton>
                    <label class="ml-2">{{ radioOption.label }}</label>
                  </div>
                </span>

                <!-- <span *ngIf="field.value.controlType.value == 7 && field.value.displayInClient==true && field.value.isUsed==true">
                                    <div>
                                        <p-calendar optionLabel="name"
                                            required="field.value.required"></p-calendar>
                                    </div>
                                </span> -->

                <span
                  *ngIf="field.value.controlType.value == 1 && field.value.displayInClient==true && field.value.isUsed==true">
                  <div>
                    <textarea pInputTextarea required="field.value.required" [(ngModel)]="field.value.value"
                      readonly="true"></textarea>
                  </div>
                </span>
              </div>

            </ng-container>
          </div>
        </div>
      </div>
      <!-- </form> -->
    </div>
    <div style="margin-top:10px;"></div>
  </div>
</p-dialog>



<p-dialog position="center" [(visible)]="historyDialogBoxFormWithoutTicketing" [style]="{width: '85vw'}"
  header="Call History" [modal]="true" styleClass="p-fluid">
  <p-table [value]="callHistoryTableData" [resizableColumns]="true" columnResizeMode="expand"
    [tableStyle]="{'max-width': '60rem'}">
    <ng-template pTemplate="header">
      <tr>
        <th *ngIf="enableCallHistoryCRM"></th>

        <th pResizableColumn="campName" pSortableColumn="campName" style="width: 3.2px;">CampaignName
        </th>
        <th pResizableColumn="leadSet" pSortableColumn="leadSet" style="width:3.2px;">LeadSet
        </th>
        <th pResizableColumn="agentID" pSortableColumn="agentID" style="width:3.2px;">AgentNo
        </th>
        <th pResizableColumn="phoneNo" pSortableColumn="phoneNo" style="width:3.2px;">PhoneNo
        </th>
        <th pResizableColumn="callTime" pSortableColumn="callTime" style="width:3.2px;">CallTime
        </th>
        <th pResizableColumn="disposition" pSortableColumn="disposition" style="width:3.2px;">Disposition
        </th>
        <th pResizableColumn="solutionProvided" pSortableColumn="solutionProvided" style="width:3.2px;">
          SolnProvided
        </th>
        <th pResizableColumn="customerFeedBack" pSortableColumn="customerFeedBack" style="width:3.2px;">
          CustFeedBack
        </th>
        <th pResizableColumn="currentStatus" pSortableColumn="currentStatus" style="width:3.2px;">CurrStatus
        </th>
        <th pResizableColumn="thirdPartyCallID" pSortableColumn="thirdPartyCallID" style="width:3.2px;">
          3rdPartyID
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-product>
      <tr>
        <td *ngIf="enableCallHistoryCRM"><i class="pi pi-eye" style="font-size: 1rem"
            (click)="openNonVoiceCustForm()"></i></td>

        <td>{{product.campName}} </td>
        <td>{{product.leadSet}}</td>
        <td>{{product.agentID}} </td>
        <td>{{product.phoneNo}} </td>
        <td>{{product.callTime}}</td>
        <td>{{product.disposition}} </td>
        <td>{{product.solutionProvided}} </td>
        <td>{{product.customerFeedBack}}</td>
        <td>{{product.currentStatus}} </td>
        <td>{{product.thirdPartyCallID}}</td>
      </tr>
    </ng-template>
  </p-table>
</p-dialog>
<p-dialog position="center" [(visible)]="getUdatedDialogData" [style]="{width: '85vw'}" header="Update Ticket"
  [modal]="true" styleClass="p-fluid">
  <div class="p-fluid formgrid grid overflow-y-auto" style="padding: 10px;
width: 100%;
margin: auto;">
    <div class="col-12 md:col-12 card">
      <div class="cardTicket dispositioncard2">

        <div class="cardTicket" style="background-color: #128c7e;
          height: 47px;
          display: flex;
          align-items: center;
          text-align: center;" *ngIf="showTicketCard">
          <ul
            style="display: flex; color:white; margin-top:0rem; margin-bottom:0rem; padding-left:0.5rem;font-size: 10px;">
            <li>Ticket Id: {{ticketNo}}</li>
            <span style="margin-left:40px;"></span>
            <li>Source: {{sourceName}}</li>
            <span style="margin-left:40px;"></span>
            <li>Campaign: {{ticketCampaignName}}</li>
            <span style="margin-left:40px;"></span>
            <li>ActionNo: {{actionNo}}</li>
            <span style="margin-left:40px;"></span>
            <li>Ticket Time: {{ticketTime}}</li>
            <span style="margin-left:40px;"></span>
            <li>Duration: {{ticketDuration}}</li>
          </ul>

        </div>
        <div class="cardTicket" *ngIf="showTicketCard">
          <form [formGroup]="customForm">
            <div>
              <div class=" dynamic-form-card">
                <div class="p-fluid formgrid grid">
                  <ng-container *ngFor="let field of formFields">
                    <div *ngIf="field.fld_isNewRow==true" style="min-inline-size: -webkit-fill-available !important;">
                    </div>
                    <div class="field col-12 md:col-12" *ngIf="field.isSeparator==true">{{field.separatorText}}</div>
                    <div style="font-size:11px !important; margin-top:5px;" class="field col-12 md:col-2"
                      *ngIf="field.fld_Enable_Search==false">
                      <span style="padding-left:10px; ">{{field.name}}</span>
                    </div>
                    <div class="field col-12 md:col-2">
                      <span
                        *ngIf="field.controlType.value == 0 && field.displayInClient==true && field.isUsed==true && field.isUsed==true && field.fld_Enable_Search==false">
                        <div
                          *ngIf="field.name == 'Phone Number' || field.name == 'PhoneNo' || field.name == 'PhoneNo*' || field.name == 'Phone No'">
                          <input type="text" pInputText [formControlName]="field.fld_FieldName" *ngIf="!isMasked"
                            required="field.required" class="p-inputtext-sm" style=" user-select: none !important;">

                          <input type="text" pInputText id="phoneInput" *ngIf="isMasked" required="field.required"
                            class="p-inputtext-sm" style=" user-select: none !important;">

                        </div>

                        <!-- <div *ngIf="!(field.name == 'Phone Number')"> -->
                        <div
                          *ngIf="!(field.name == 'Phone Number' ||  field.name == 'PhoneNo' || field.name == 'PhoneNo*'  || field.name == 'Phone No')">
                          <input type="text" pInputText [formControlName]="field.fld_FieldName"
                            required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable">
                        </div>
                      </span>
                      <span
                        *ngIf="field.fld_Enable_Search==true && field.isUsed==true && myStudentFiledTrueFalse && !teacherFiledTrueFalse">
                        <div
                          *ngIf="field.name === 'Student Id' || field.name === 'Student Name' || field.name === 'Grade'">
                          <div style="font-size:11px !important; margin-top:5px;">
                            <span style="padding-left:10px; ">{{field.name}}</span>
                          </div>
                          <input type="text" pInputText [formControlName]="field.fld_FieldName"
                            required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                            style="user-select: none !important;">
                        </div>
                      </span>
                      <span
                        *ngIf="field.fld_Enable_Search==true && field.isUsed==true && teacherFiledTrueFalse && !myStudentFiledTrueFalse">
                        <div
                          *ngIf="field.name === 'Teacher Code' || field.name === 'Teacher Name' || field.name === 'Registered Mobile Number'">
                          <div style="font-size:11px !important; margin-top:5px;">
                            <span style="padding-left:10px; ">{{field.name}}</span>
                          </div>
                          <input type="text" pInputText [formControlName]="field.fld_FieldName"
                            required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                            style="user-select: none !important;">
                        </div>
                      </span>
                      <span *ngIf="field.controlType.value == 2 && field.displayInClient==true && field.isUsed==true ">
                        <ng-container *ngIf="!hideDropDownEnableDIsable">
                          <div *ngIf="field.name === 'School Code'">
                            <!-- <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                                  class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                                  required="field.required" placeholder="select" [readonly]="!field.isEditable"  (onSelect)="firstParentValue($event,field)" (onChange)="firstParentValue($event,field)"
                                                  [filter]="true" filterBy="label">
                                              </p-dropdown> -->
                            <p-dropdown [options]="selctedSchoolCode" [(ngModel)]="schoolCodeValue" placeholder="Select"
                              [editable]="true" [ngModelOptions]="{standalone: true}" [filter]="true" filterBy="sclCode"
                              (onFilter)="customFilterFunction($event)" (onClear)="ocClearData($event)"
                              optionLabel="sclCode" (onSelect)="checkValueAfterClick($event)"
                              (onChange)="checkValueAfterClick($event)">
                              <ng-template pTemplate="selectedItem" let-selectedUser>
                                <div class="selectedUser-item">
                                  <div>{{selectedUser.sclCode}}</div>
                                </div>
                              </ng-template></p-dropdown>
                          </div>
                          <ng-container>
                            <div *ngIf="field.name === 'School Name'">
                              <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="schoolNameValue"
                                [ngModelOptions]="{standalone: true}" />
                            </div>
                            <div *ngIf="field.name === 'District'">
                              <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="districtValue"
                                [ngModelOptions]="{standalone: true}" />
                            </div>
                            <div *ngIf="field.name === 'Block Name'">
                              <input type="text" class="p-inputtext-sm" pInputText [(ngModel)]="blockNameValue"
                                [ngModelOptions]="{standalone: true}" />
                            </div>
                          </ng-container>

                        </ng-container>
                        <ng-container
                          *ngIf="hideDropDownEnableDIsable && field.name != 'Designation' && field.name != 'Problem Reported' && field.name != 'Problem Category' && field.name != 'Dependent upon (State/CG)' &&  field.name != 'Bot Name'">
                          <input type="text" pInputText [formControlName]="field.fld_FieldName"
                            required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                            style="user-select: none !important;">
                          <span (click)="returnDropDownFirst" *ngIf="field.name === 'School Code'" style="    position: relative; 
                                   float: right;
                                   bottom: 43px;
                                   left: 6px;">
                            <i class="pi pi-times-circle" style="font-size: 20px" (click)="returnDropDownFirst()"
                              sty></i>
                          </span>
                        </ng-container>
                        <ng-container
                          *ngIf="hidePropertyValueEnable && field.name != 'Designation'   &&  field.name != 'Bot Name' && field.name != 'District' &&  field.name != 'School Name' && field.name != 'School Code' && field.name != 'Block Name'">
                          <input type="text" pInputText [formControlName]="field.fld_FieldName"
                            required="field.required" class="p-inputtext-sm" [readonly]="!field.isEditable"
                            style="user-select: none !important;">
                          <span (click)="returnDropDownSecond" *ngIf="field.name === 'Problem Reported'" style="    position: relative;
                                   float: right;
                                   bottom: 43px;
                                   left: 6px;">
                            <i class="pi pi-times-circle" style="font-size: 20px" (click)="returnDropDownSecond()"></i>
                          </span>
                        </ng-container>
                        <div
                          *ngIf="field.name != 'District' &&  field.name != 'School Name' && field.name != 'School Code' && field.name != 'Block Name' && field.name != 'Problem Reported' && field.name != 'Problem Category' && field.name != 'Dependent upon (State/CG)'">
                          <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                            (onSelect)="getingBotNameValue($event,field)" (onChange)="getingBotNameValue($event,field)"
                            class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                            placeholder="select" [readonly]="!field.isEditable" [filter]="true" filterBy="label">
                          </p-dropdown>
                        </div>
                        <ng-container *ngIf="!hidePropertyValueEnable">
                          <div *ngIf="field.name === 'Problem Reported'">
                            <!-- <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                                              class="p-inputtext-sm" [formControlName]="field.fld_FieldName"
                                              required="field.required" placeholder="select" [readonly]="!field.isEditable"  (onSelect)="firstProblemDropDownValue($event,field)" (onChange)="firstProblemDropDownValue($event,field)"
                                              [filter]="true" filterBy="label">
                                          </p-dropdown> -->
                            <p-dropdown [options]="getValueParakhBot" [(ngModel)]="problemReportedValue"
                              [ngModelOptions]="{standalone: true}" optionLabel="value" optionValue="value"
                              class="p-inputtext-sm" placeholder="Select"
                              (onSelect)="firstProblemDropDownValue($event,field)"
                              (onChange)="firstProblemDropDownValue($event,field)" [filter]="true" filterBy="value">
                              <ng-template pTemplate="selectedItem" let-selectedUser>
                                <div class="selectedUser-item" style="width: 100px !important;">
                                  <div>{{selectedUser.value}}</div>
                                </div>
                              </ng-template>
                            </p-dropdown>
                          </div>
                          <div *ngIf="field.name === 'Problem Category' && mainProblemDropDownValue">
                            <p-dropdown [options]="ProblemCategoryArr" optionlabel="label" optionValue="value"
                              class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                              placeholder="select" [readonly]="!field.isEditable"
                              (onSelect)="ProblemCategoryVFun($event,field)"
                              (onChange)="ProblemCategoryVFun($event,field)" [filter]="true" filterBy="label">
                            </p-dropdown>
                          </div>
                          <div *ngIf="field.name === 'Problem Category' && !mainProblemDropDownValue">
                            <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                              class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                              placeholder="select" [readonly]="!field.isEditable"
                              (onSelect)="ProblemCategoryVFun($event,field)"
                              (onChange)="ProblemCategoryVFun($event,field)" [filter]="true" filterBy="label">
                            </p-dropdown>
                          </div>
                          <div *ngIf="field.name === 'Dependent upon (State/CG)' && mainNewVariableCheckDepenedent">
                            <p-dropdown [options]="dependentVariavbles" optionlabel="label" optionValue="value"
                              class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                              placeholder="select" [readonly]="!field.isEditable"
                              (onSelect)="DependentuponFunc($event,field)" (onChange)="DependentuponFunc($event,field)"
                              [filter]="true" filterBy="label">
                            </p-dropdown>
                          </div>
                          <div *ngIf="field.name === 'Dependent upon (State/CG)' && !mainNewVariableCheckDepenedent">
                            <p-dropdown [options]="field.selectItems" optionlabel="label" optionValue="value"
                              class="p-inputtext-sm" [formControlName]="field.fld_FieldName" required="field.required"
                              placeholder="select" [readonly]="!field.isEditable"
                              (onSelect)="DependentuponFunc($event,field)" (onChange)="DependentuponFunc($event,field)"
                              [filter]="true" filterBy="label">
                            </p-dropdown>
                          </div>
                        </ng-container>

                      </span>

                      <span *ngIf="field.controlType.value == 3 && field.displayInClient==true && field.isUsed==true">
                        <div>
                          <p-checkbox binary="true" inputId="binary" [formControlName]="field.fld_FieldName"
                            required="field.required" [readonly]="!field.isEditable">
                          </p-checkbox>
                        </div>
                      </span>

                      <span *ngIf="field.controlType.value == 4 && field.displayInClient==true && field.isUsed==true">
                        <div>
                          <p-radioButton [formControlName]="field.fld_FieldName" required="field.required"
                            [readonly]="!field.isEditable">
                          </p-radioButton>
                        </div>
                      </span>

                      <span *ngIf="field.controlType.value == 5 && field.displayInClient==true && field.isUsed==true">
                        <div>
                          <p-listbox [formControlName]="field.fld_FieldName" optionLabel="name"
                            required="field.required" [readonly]="!field.isEditable"></p-listbox>
                        </div>
                      </span>

                      <span *ngIf="field.controlType.value == 1 && field.displayInClient==true && field.isUsed==true">
                        <div>
                          <textarea pInputTextarea [formControlName]="field.fld_FieldName" required="field.required"
                            [readonly]="!field.isEditable"></textarea>
                        </div>
                      </span>

                      <span *ngIf="field.controlType.value == 8 && field.displayInClient==true && field.isUsed==true">
                        <div>
                          <p-multiSelect [options]="cities" class="p-inputtext-sm" optionLabel="name"
                            required="field.required" [formControlName]="field.fld_FieldName" placeholder="select"
                            [readonly]="!field.isEditable"></p-multiSelect>
                        </div>
                      </span>
                    </div>
                  </ng-container>
                </div>
                <!-- <div class="field col-12 md:col-5 flex">
                          <p-button label="New Ticket" (onClick)="newTicket()" [hidden]="!ticketEnable"></p-button>
                          <div style="margin: 0 5px;"></div>
                          <p-button label="Open DM Chat" (click)="dmChat()" [hidden]="!liveDM"></p-button>
                      </div> -->
              </div>
            </div>
          </form>
          <!-- assign by && Ticket Status -->
          <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
            <div class="col-12 mb-0 md:col-2 md:mb-0">Assigned By:<span style="color:red">*</span></div>
            <div class="col-12 mb-0 md:col-3 md:mb-0">
              <input type="text" pInputText [(ngModel)]="selectedAssignedBy" readonly="true" class="p-inputtext-sm" />
            </div>

            <div class="col-12 mb-0 md:col-2 md:mb-0">Ticket Status<span style="color:red">*</span></div>
            <div class="col-12 mb-0 md:col-3 md:mb-0">
              <p-dropdown class="p-inputtext-sm" id="ticketStatus" [options]="ticketStatusDropdownData"
                [disabled]="disabledTicketFields" [filter]="true" filterBy="label" optionLabel="label"
                optionValue="value" [(ngModel)]="selectedticketStatus" [showClear]="true" placeholder="Select"
                (onClick)="getTicketStatus()">
                <ng-template let-selectedType pTemplate="item">
                  <div class="selectedType-item">
                    <div>{{selectedType.label}}</div>
                  </div>
                </ng-template>
              </p-dropdown>
            </div>
          </div>

          <!-- ticket type -->
          <!-- <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
                  <div class="col-12 mb-0 md:col-2 md:mb-0 ">Ticket Type:<span style="color:red">*</span></div>
                  <div class="col-12 mb-0 md:col-3 md:mb-0">
                      <i class="pi pi-chevron-circle-left" style="font-size: 1.7rem"
                          (click)="previousIconTicketType()"></i>
                      <p-dropdown class="p-inputtext-sm" id="ticketType" [options]="ticketTypeDropdownData"
                          appendTo="body" [disabled]="disabledTicketFields" [filter]="true" filterBy="label"
                          optionLabel="label" optionValue="value" [(ngModel)]="selectedTicketType" [showClear]="true"
                          placeholder="Select ">
                          <ng-template let-selectedType pTemplate="item">
                              <div class="selectedType-item">
                                  <div>{{selectedType.label}}</div>
                              </div>
                          </ng-template>
                      </p-dropdown>
                      <i class="pi pi-chevron-circle-right" style="font-size: 1.7rem"
                          (click)="forwardIconTicketType()"></i>
                  </div>
              </div> -->

          <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
            <div class="col-12 mb-0 md:col-2 md:mb-0 ">Ticket Type:<span style="color:red">*</span></div>

            <!-- 1st Dropdown -->
            <div class="col-12 mb-0 md:col-3 md:mb-0" *ngFor="let item of arrObj; let i = index">
              <p-dropdown class="p-inputtext-sm" id="ticketType[i]" [options]="ticketTypeDropdownData[i]"
                [disabled]="disabledTicketFields" appendTo="body" [filter]="true" filterBy="label" optionLabel="label"
                optionValue="value" [(ngModel)]="selectedTicketType[i] " [showClear]="true" placeholder="Select"
                (onChange)="ticketTypeDropdown(i)">
                <ng-template let-selectedType pTemplate="item">
                  <div class="selectedType-item">
                    <div>{{selectedType.label}}</div>
                  </div>
                </ng-template>
              </p-dropdown>
            </div>

          </div>


          <!-- tree -->
          <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
            <div class="col-12 mb-0 md:col-12 md:mb-0">Tree : {{tree}}</div>

          </div>

          <!-- voice file -->
          <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;"
            *ngIf="voicefile">
            <div class="col-12 mb-0 md:col-2 md:mb-0">Voice File:</div>
            <div class="col-12 mb-0 md:col-6 md:mb-0">
              <audio controls>
                <source [src]="voicefile" type="audio/wav">
              </audio>
            </div>
          </div>
        </div>



        <div class="cardTicket" *ngIf="showTicketCard">
          <div class="grid forms-grid flex-row p-fluid" style="padding-left: 10px !important; margin-top:10px;">
            <div class="col-12 mb-0 md:col-2 md:mb-0">Agent Remarks:</div>
            <div class="col-12 mb-0 md:col-6 md:mb-0">
              <textarea rows="2" cols="40" id="agentRemarks" name="agentRemarks" pInputTextarea class="p-inputtext"
                [disabled]="disabledTicketFields" placeholder=" " [(ngModel)]="agentRemarks"></textarea>
            </div>
          </div>
        </div>


        <div class="cardTicket" *ngIf="showTicketCard">
          <div class="grid forms-grid flex-row p-fluid"
            style="padding-left: 10px !important; margin-top:10px;padding-bottom: 11px;">

            <div class="col-12 mb-0 md:col-1 md:mb-0">
              <div>Ticket Id</div>
            </div>
            <div class="col-12 mb-0 md:col-2 md:mb-0">
              <div><input class="p-inputtext-sm" type="text" pInputText [(ngModel)]="ticketNo" /></div>
            </div>

            <div class="col-12 mb-0 md:col-3 md:mb-0">
              <button (click)="callHistory()" pButton pRipple type="button" label="Ticket History" style="background: #128c7e;    white-space: pre;
    width: 100%;">
              </button>
            </div>
            <div class="col-12 mb-0 md:col-2 md:mb-0">
              <button pButton pRipple type="submit" style="background: #128c7e;" label="Save"
                (click)="saveDynamicLeadCustField()" *ngIf="showSaveButton">
              </button>
              <button pButton (click)="updateTiecket()" pButton pRipple style="background: #128c7e;" type="Update"
                label="Update" *ngIf="showUpdateButton">
              </button>
            </div>
          </div>
        </div>
      </div>



    </div>
  </div>
</p-dialog>

<!-- <p-button (onClick)="showDialog()" label="Show" /> -->
<p-dialog header="Rejection Reason" [modal]="true" [(visible)]="isReasonRejection" [style]="{ width: '40rem' }"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }">
  <p class="mb-1" style="display: flex;justify-content: center;align-items: center;text-align: center;">
    <img src="assets/demo/errorVal.gif" alt="" style="height: 100px;width: 100px;">
  </p>
  <p class="mb-1">
    Error Code - {{myRejectionMessage?.errorcode}}
  </p>
  <p class="mb-1">
    Error - {{myRejectionMessage?.errorname}}
  </p>
  <p class="mb-5">
    Reason - {{myRejectionMessage?.errorreason}}
  </p>
  <div class="flex justify-content-end gap-2">
    <a href="https://developers.facebook.com/docs/whatsapp/cloud-api/support/error-codes/" target="_blank"
      rel="noopener noreferrer">
      More Info
    </a>
  </div>
</p-dialog>

<!-- contacts dialog -->
<p-dialog header="Share Invite" [modal]="true" [(visible)]="smsVariableTrueFalse" [style]="{ width: '25rem' }">
  <!-- <span class="p-text-secondary block mb-5">Update your information.</span> -->
  <div class="flex align-items-center gap-3 mb-3">
    <label for="username" class="font-semibold w-6rem">Number</label>
    <!-- <input pInputText id="username" class="flex-auto" [(ngModel)]="selectedTemp" autocomplete="off" /> -->
    <p-inputNumber [(ngModel)]="smsNumber" mode="decimal" inputId="withoutgrouping"
      [useGrouping]="false"></p-inputNumber>
  </div>
  <!-- <div class="flex align-items-center gap-3 mb-5">
      <label for="email" class="font-semibold w-6rem">Email</label>
      <input pInputText id="email" class="flex-auto" autocomplete="off" />
  </div> -->
  <div class="flex justify-content-end gap-2">
    <p-button label="Cancel" severity="secondary" style="margin-right: 10px;"
      (onClick)="smsVariableTrueFalse = false"></p-button>
    <p-button label="Save" (click)="sendSMSDetails()"></p-button>
  </div>
</p-dialog>
<p-confirmPopup>
  <ng-template pTemplate="content" let-message>
    <div class="flex flex-column align-items-center w-full gap-3 border-bottom-1 surface-border p-3 mb-3">
      <i [class]="message.icon" class="text-6xl text-primary-500"></i>
      <p>{{ message.message }}</p>
    </div>
  </ng-template>
</p-confirmPopup>